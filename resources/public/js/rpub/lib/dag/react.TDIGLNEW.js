import*as l from"cherry-cljs/cljs.core.js";import*as m from"react";import{useCallback as h,useContext as w,useSyncExternalStore as b,useId as y}from"react";import*as d from"rpub.lib.dag";var p=m.createContext.call(null),A=function(n){return m.createElement.call(null,p.Provider,{value:l.array_map(l.keyword("dag-atom"),n["dag-atom"])},n.children)},g=function(n,o,e){return l.some.call(null,function(u){return l.get_in.call(null,n,l.vector(l.keyword("rpub.lib.dag/values"),u))!==l.get_in.call(null,o,l.vector(l.keyword("rpub.lib.dag/values"),u))},e)},$=function(n,o,e,u){return l.swap_BANG_.call(null,n,function(i){return l.reduce.call(null,function(a,r){if(l.truth_.call(null,l.not.call(null,l.vector_QMARK_.call(null,r))))return a;{const c=r,_=l.nth.call(null,c,0,null),f=l.nth.call(null,c,1,null),t=function(s){return l.get_in.call(null,a,l.vector(l.keyword("rpub.lib.dag/nodes"),_,l.keyword("calc"))).call(null,s,f)};return d.add_node.call(null,a,r,l.array_map(l.keyword("calc"),t),l.vector(l.vector(_,r)))}},i,e)}),l.add_watch.call(null,n,o,function(i,a,r,c){if(l.truth_.call(null,g.call(null,r,c,e)))return u.call(null)}),function(){return l.remove_watch.call(null,n,o),l.swap_BANG_.call(null,n,function(a){return l.reduce.call(null,function(r,c){return l.truth_.call(null,l.not.call(null,l.vector_QMARK_.call(null,c)))?r:d.remove_node.call(null,r,c)},a,e)})}},k=function(n){const o=w.call(null,p),e=l.__destructure_map.call(null,o),u=l.get.call(null,e,l.keyword("dag-atom")),i=y.call(null),a=function(t){return $.call(null,u,i,n,t)},r=function(){return l.deref.call(null,u)},c=b.call(null,a,r),_=l.select_keys.call(null,l.keyword("rpub.lib.dag/values").call(null,c),n),f=h.call(null,(()=>{const t=function(s){switch(l.alength.call(null,arguments)){case 1:return t.cljs$core$IFn$_invoke$arity$1(arguments[0]);case 2:return t.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);default:throw new Error(l.str.call(null,"Invalid arity: ",l.alength.call(null,arguments)))}};return t.cljs$core$IFn$_invoke$arity$1=function(s){return l.swap_BANG_.call(null,u,d.push,s),null},t.cljs$core$IFn$_invoke$arity$2=function(s,v){return l.swap_BANG_.call(null,u,d.push,s,v),null},t.cljs$lang$maxFixedArity=2,t})(),[]);return l.vector(_,f)};export{A as DAGProvider,$ as subscribe,g as updated_QMARK_,k as use_dag};
