import*as cherry_core from"cherry-cljs/cljs.core.js";import*as cherry from"cherry-cljs/lib/compiler.js";import"preact/debug";import*as pprint from"cherry-cljs/lib/cljs.pprint.js";import*as str from"cherry-cljs/lib/clojure.string.js";import*as transit from"rpub.lib.transit";var cherry_state=cherry_core.atom.call(null,null),cherry_opts={repl:!0,async:!0,context:"return","elide-exports":!0},eval_cherry_string=function(state_atom,s){const st1=cherry.compileStringEx.call(null,s,cherry_opts,cherry_core.deref.call(null,cherry_state)),code2=cherry_core.str.call(null,`(async function() {
`,st1.javascript,`
})()`),ret3=eval(code2);return cherry_core.reset_BANG_.call(null,state_atom,st1),ret3},eval_cherry=function(e){const c=cherry_core.truth_.call(null,cherry_core.string_QMARK_.call(null,e))?e:cherry_core.pr_str.call(null,e);return eval_cherry_string.call(null,cherry_state,c)},start_websocket_client_BANG_=function(e){const c=e,l=cherry_core.__destructure_map.call(null,c),_=cherry_core.get.call(null,l,cherry_core.keyword("url")),t=cherry_core.get.call(null,l,cherry_core.keyword("on-open")),o=cherry_core.get.call(null,l,cherry_core.keyword("on-close")),a=cherry_core.get.call(null,l,cherry_core.keyword("on-error")),y=cherry_core.get.call(null,l,cherry_core.keyword("on-message")),r=new WebSocket(_);return r.onmessage=function(n){return y.call(null,r,n.data)},r.onopen=function(){if(cherry_core.truth_.call(null,t))return t.call(null,r)},r.onclose=function(){if(cherry_core.truth_.call(null,o))return o.call(null,r)},r.onerror=function(n){if(cherry_core.truth_.call(null,a))return a.call(null,r,n)}},handle_ws_open=function(){return cherry_core.println.call(null,"[cljs] WebSocket opened")},handle_ws_close=function(){return cherry_core.println.call(null,"[cljs] WebSocket closed")},handle_ws_error=function(e){return console.log(e)},handle_ws_message=function(e,c){const l=transit.read.call(null,c),_=cherry_core.__destructure_map.call(null,l),t=cherry_core.get.call(null,_,cherry_core.keyword("id")),o=cherry_core.get.call(null,_,cherry_core.keyword("code")),a=function(y){const r=(()=>{const h=cherry_core.atom.call(null,""),u=cherry_core._STAR_print_fn_STAR_;try{cherry_core.set_print_fn_BANG_.call(null,function(i){return cherry_core.swap_BANG_.call(null,h,cherry_core.str,i)}),pprint.pprint.call(null,y)}finally{cherry_core.set_print_fn_BANG_.call(null,u)}return cherry_core.deref.call(null,h)})(),n=cherry_core.array_map(cherry_core.keyword("id"),t,cherry_core.keyword("value"),cherry_core.pr_str.call(null,y));return cherry_core.println.call(null,cherry_core.str.call(null,"[cljs] => ",o,`
`,r)),e.send(transit.write.call(null,n))};return eval_cherry.call(null,o).then(a)},init_repl_BANG_=function(){return cherry_core.println.call(null,"[cljs] REPL started"),window.evalCherry=eval_cherry,start_websocket_client_BANG_.call(null,cherry_core.array_map(cherry_core.keyword("url"),"ws://localhost:7778",cherry_core.keyword("on-open"),handle_ws_open,cherry_core.keyword("on-close"),handle_ws_close,cherry_core.keyword("on-error"),handle_ws_error,cherry_core.keyword("on-message"),handle_ws_message))},repl_ns=cherry_core.list(cherry_core.symbol.call(null,"do"),cherry_core.list(cherry_core.symbol.call(null,"ns"),cherry_core.symbol.call(null,"user"),cherry_core.list(cherry_core.keyword("require"),cherry_core.vector(cherry_core.symbol.call(null,"rpub.lib.tap"),cherry_core.keyword("as"),cherry_core.symbol.call(null,"tap")),cherry_core.vector(cherry_core.symbol.call(null,"rpub.dev.cljs.client"),cherry_core.keyword("as"),cherry_core.symbol.call(null,"client")))),cherry_core.list(cherry_core.symbol.call(null,"defonce"),cherry_core.symbol.call(null,"tap-fn"),cherry_core.list(cherry_core.symbol.call(null,"fn"),cherry_core.vector(cherry_core.symbol.call(null,"x")),cherry_core.list(cherry_core.symbol.call(null,"tap/remote-tap"),"/admin/tap",cherry_core.symbol.call(null,"x")))),cherry_core.list(cherry_core.symbol.call(null,"add-tap"),cherry_core.symbol.call(null,"tap-fn")),cherry_core.list(cherry_core.symbol.call(null,"client/init-repl!")),cherry_core.list(cherry_core.symbol.call(null,"ns"),cherry_core.symbol.call(null,"rpub.dev.cljs.repl"),cherry_core.list(cherry_core.keyword("require"),cherry_core.vector(cherry_core.symbol.call(null,"rpub.admin"),cherry_core.keyword("as"),cherry_core.symbol.call(null,"admin")),cherry_core.vector(cherry_core.symbol.call(null,"rpub.admin.dag"),cherry_core.keyword("as"),cherry_core.symbol.call(null,"admin-dag")),cherry_core.vector(cherry_core.symbol.call(null,"rpub.lib.dag"),cherry_core.keyword("as"),cherry_core.symbol.call(null,"dag"))))),start_BANG_=function(){return eval_cherry.call(null,repl_ns)};export{cherry_opts,cherry_state,eval_cherry,eval_cherry_string,handle_ws_close,handle_ws_error,handle_ws_message,handle_ws_open,init_repl_BANG_,repl_ns,start_BANG_,start_websocket_client_BANG_};
