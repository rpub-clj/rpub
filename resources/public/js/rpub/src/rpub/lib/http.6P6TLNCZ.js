import*as l from"cherry-cljs/cljs.core.js";import*as p from"rpub.lib.transit";var w=function(){return document.querySelector("meta[name='csrf-token']").getAttribute("content")},m=function(e,r){const _=r,a=l.__destructure_map.call(null,_),i=a,s=l.get.call(null,a,l.keyword("body")),o=l.get.call(null,a,l.keyword("on-complete")),c=l.merge.call(null,l.array_map(l.keyword("format"),l.keyword("json")),i),d=(()=>{const n=l.keyword("format").call(null,c),t=l.truth_.call(null,l.keyword_QMARK_.call(null,n))?l.subs.call(null,l.str.call(null,n),1):null;switch(t){case"json":return"application/json";case"transit":return"application/transit+json";default:throw new Error(l.str.call(null,"No matching clause: ",t))}})(),f=l.array_map("X-CSRF-Token",w.call(null),"Accept",d,"Content-Type",d),k=function(n){const t=l.keyword("format").call(null,c),u=l.truth_.call(null,l.keyword_QMARK_.call(null,t))?l.subs.call(null,l.str.call(null,t),1):null;switch(u){case"json":return l.js__GT_clj.call(null,JSON.parse(n));case"transit":return p.read.call(null,n);default:throw new Error(l.str.call(null,"No matching clause: ",u))}},h=function(n){const t=l.keyword("format").call(null,c),u=l.truth_.call(null,l.keyword_QMARK_.call(null,t))?l.subs.call(null,l.str.call(null,t),1):null;switch(u){case"json":return JSON.stringify(l.clj__GT_js.call(null,n));case"transit":return p.write.call(null,n);default:throw new Error(l.str.call(null,"No matching clause: ",u))}},b=(()=>{const n=l.array_map(l.keyword("method"),l.keyword("post"),l.keyword("headers"),f);return l.truth_.call(null,s)?l.assoc.call(null,n,l.keyword("body"),h.call(null,s)):n})(),j=fetch(e,l.clj__GT_js.call(null,b));return l.truth_.call(null,o)&&j.then(function(n){return n.text()}).then(function(n){return o.call(null,k.call(null,n))},null).catch(function(n){return o.call(null,null,n)}),null},y=function(e,r){return new Promise(function(_,a){const i=function(o,c){return l.truth_.call(null,c)?a.call(null,c):_.call(null,o)},s=l.merge.call(null,r,l.array_map(l.keyword("on-complete"),i,l.keyword("format"),l.keyword("transit")));return m.call(null,e,s)})},G=function(e,r){return l.truth_.call(null,l.keyword("on-complete").call(null,r))?m.call(null,e,r):y.call(null,e,r)};export{w as get_csrf_token,G as post,m as post_callback,y as post_promise};
