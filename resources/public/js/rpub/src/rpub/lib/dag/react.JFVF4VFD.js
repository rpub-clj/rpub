import*as l from"cherry-cljs/cljs.core.js";import*as p from"react";import{useCallback as j,useContext as x,useSyncExternalStore as A,useId as I}from"react";import*as g from"rpub.lib.dag";var m=p.createContext.call(null),F=function(n){return p.createElement.call(null,m.Provider,{value:l.array_map(l.keyword("dag-atom"),n["dag-atom"])},n.children)},y=function(n,e,c){return l.some.call(null,function(s){return l.get_in.call(null,n,l.vector(l.keyword("rpub.lib.dag/values"),s))!==l.get_in.call(null,e,l.vector(l.keyword("rpub.lib.dag/values"),s))},c)},h=function(n,e,c,s){return l.swap_BANG_.call(null,n,function(o){return l.reduce.call(null,function(u,r){if(l.truth_.call(null,l.not.call(null,l.vector_QMARK_.call(null,r))))return u;{const t=r,i=l.nth.call(null,t,0,null),f=l.nth.call(null,t,1,null),v=function(a){return l.get_in.call(null,u,l.vector(l.keyword("rpub.lib.dag/nodes"),i,l.keyword("calc"))).call(null,a,f)};return g.add_node.call(null,u,r,l.array_map(l.keyword("calc"),v),l.vector(l.vector(i,r)))}},o,c)}),l.add_watch.call(null,n,e,function(o,u,r,t){if(l.truth_.call(null,y.call(null,r,t,c)))return s.call(null)}),function(){return l.remove_watch.call(null,n,e),l.swap_BANG_.call(null,n,function(u){return l.reduce.call(null,function(r,t){return l.truth_.call(null,l.not.call(null,l.vector_QMARK_.call(null,t)))?r:g.remove_node.call(null,r,t)},u,c)})}},w=(()=>{const n=function(e){switch(l.alength.call(null,arguments)){case 0:return n.cljs$core$IFn$_invoke$arity$0();case 1:return n.cljs$core$IFn$_invoke$arity$1(arguments[0]);default:throw new Error(l.str.call(null,"Invalid arity: ",l.alength.call(null,arguments)))}};return n.cljs$core$IFn$_invoke$arity$0=function(){return w.call(null,null)},n.cljs$core$IFn$_invoke$arity$1=function(e){const c=x.call(null,m),s=l.__destructure_map.call(null,c),o=l.get.call(null,s,l.keyword("dag-atom")),u=I.call(null),r=function(a){return h.call(null,o,u,e,a)},t=function(){return l.deref.call(null,o)},i=A.call(null,r,t),f=l.select_keys.call(null,l.keyword("rpub.lib.dag/values").call(null,i),e),v=j.call(null,(()=>{const a=function(_){const $=l.array.call(null),b=l.alength.call(null,arguments);let d=0;for(;;){if(d<b){$.push(arguments[d]),d=d+1;continue}break}const k=0<l.alength.call(null,$)?new l.IndexedSeq($.slice(0),0,null):null;return a.cljs$core$IFn$_invoke$arity$variadic(k)};return a.cljs$core$IFn$_invoke$arity$variadic=function(_){return l.apply.call(null,l.swap_BANG_,o,g.push,_)},a.cljs$lang$maxFixedArity=0,a.cljs$lang$applyTo=function(_){return this.cljs$core$IFn$_invoke$arity$variadic(l.seq.call(null,_))},a})(),[]);return l.vector(f,v)},n.cljs$lang$maxFixedArity=1,n})();export{F as DAGProvider,h as subscribe,y as updated_QMARK_,w as use_dag};
