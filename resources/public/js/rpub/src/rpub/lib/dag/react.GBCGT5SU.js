import*as l from"cherry-cljs/cljs.core.js";import*as w from"react";import{useCallback as g,useContext as b,useSyncExternalStore as F,useId as G}from"react";import*as s from"rpub.lib.dag";var y=w.createContext.call(null),D=function(n){return w.createElement.call(null,y.Provider,{value:l.array_map(l.keyword("dag-atom"),n["dag-atom"])},n.children)},k=function(n,t,a){return l.some.call(null,function(c){if(l.truth_.call(null,l.vector_QMARK_.call(null,c))){const e=c,_=l.nth.call(null,e,0,null),i=l.nth.call(null,e,1,null),f=l.get_in.call(null,n,l.vector(l.keyword("rpub.lib.dag/nodes"),_,l.keyword("calc"))).call(null,s.calc_input.call(null,n),i),v=l.get_in.call(null,t,l.vector(l.keyword("rpub.lib.dag/nodes"),_,l.keyword("calc"))).call(null,s.calc_input.call(null,t),i);return l.not_EQ_.call(null,f,v)}else return l.not_EQ_.call(null,l.get_in.call(null,n,l.vector(l.keyword("rpub.lib.dag/values"),c)),l.get_in.call(null,t,l.vector(l.keyword("rpub.lib.dag/values"),c)))},a)},j=function(n,t,a,c){return l.add_watch.call(null,n,t,function(e,_,i,f){if(l.truth_.call(null,k.call(null,i,f,a)))return c.call(null)}),function(){return l.remove_watch.call(null,n,t)}},h=(()=>{const n=function(t){switch(l.alength.call(null,arguments)){case 0:return n.cljs$core$IFn$_invoke$arity$0();case 1:return n.cljs$core$IFn$_invoke$arity$1(arguments[0]);default:throw new Error(l.str.call(null,"Invalid arity: ",l.alength.call(null,arguments)))}};return n.cljs$core$IFn$_invoke$arity$0=function(){return h.call(null,null)},n.cljs$core$IFn$_invoke$arity$1=function(t){const a=b.call(null,y),c=l.__destructure_map.call(null,a),e=l.get.call(null,c,l.keyword("dag-atom")),_=G.call(null),i=g.call(null,function(u){return j.call(null,e,_,t,u)},[]),f=g.call(null,function(){return l.deref.call(null,e)},[]),v=F.call(null,i,f),S=l.truth_.call(null,s.assertions_enabled_QMARK_.call(null))?s.assert_valid_node_keys.call(null,v,l.map.call(null,function(u){return l.truth_.call(null,l.vector_QMARK_.call(null,u))?l.first.call(null,u):u},t)):null,Q=l.reduce.call(null,function(u,r){if(l.truth_.call(null,l.vector_QMARK_.call(null,r))){const o=r,p=l.nth.call(null,o,0,null),$=l.nth.call(null,o,1,null),m=l.get_in.call(null,v,l.vector(l.keyword("rpub.lib.dag/nodes"),p,l.keyword("calc")));return l.assoc.call(null,u,r,m.call(null,s.calc_input.call(null,v),$))}else return l.assoc.call(null,u,r,l.get.call(null,l.keyword("rpub.lib.dag/values").call(null,v),r))},l.array_map(),t),x=g.call(null,(()=>{const u=function(r){const o=l.array.call(null),p=l.alength.call(null,arguments);let $=0;for(;;){if($<p){o.push(arguments[$]),$=$+1;continue}break}const m=0<l.alength.call(null,o)?new l.IndexedSeq(o.slice(0),0,null):null;return u.cljs$core$IFn$_invoke$arity$variadic(m)};return u.cljs$core$IFn$_invoke$arity$variadic=function(r){const o=l.swap_BANG_.call(null,e,function(p){return l.truth_.call(null,s.assertions_enabled_QMARK_.call(null))&&s.assert_valid_node_keys.call(null,p,l.take.call(null,1,r)),l.apply.call(null,s.push,p,r)});return l.select_keys.call(null,l.keyword("rpub.lib.dag/values").call(null,o),t)},u.cljs$lang$maxFixedArity=0,u.cljs$lang$applyTo=function(r){return this.cljs$core$IFn$_invoke$arity$variadic(l.seq.call(null,r))},u})(),[]);return l.vector(Q,x)},n.cljs$lang$maxFixedArity=1,n})(),K=function(n){const t=h.call(null,l.vector(n)),a=l.nth.call(null,t,0,null);return l.get.call(null,a,n)},M=function(){const n=h.call(null,null),t=l.nth.call(null,n,0,null),a=l.nth.call(null,n,1,null);return g.call(null,function(c){return l.apply.call(null,a,c)},[])},d=function(n,t){this.f=n,this.ref=t};d.prototype.cljs$core$IDeref$=l.PROTOCOL_SENTINEL,d.prototype.cljs$core$IDeref$_deref$arity$1=function(n){const t=this,a=this;if(l.truth_.call(null,l._EQ_.call(null,l.count.call(null,t.ref),1)))return l.first.call(null,t.ref);{const c=t.f.call(null);return t.ref[0]=c,c}},d.getBasis=function(){return l.vector(l.symbol.call(null,"f"),l.symbol.call(null,"ref"))},d.cljs$lang$type=!0,d.cljs$lang$ctorStr="Delay",d.cljs$lang$ctorPrWriter=function(n,t,a){return _write.call(null,t,"Delay")};var I=function(n,t){return new d(n,t)},A=function(n){return I.call(null,n,[])},E=function(n){const t=b.call(null,y),a=l.__destructure_map.call(null,t),c=l.get.call(null,a,l.keyword("dag-atom"));return A.call(null,function(){const e=l.deref.call(null,c);if(l.truth_.call(null,l.vector_QMARK_.call(null,n))){const _=n,i=l.nth.call(null,_,0,null),f=l.nth.call(null,_,1,null);return l.get_in.call(null,e,l.vector(l.keyword("rpub.lib.dag/nodes"),i,l.keyword("calc"))).call(null,s.calc_input.call(null,e),f)}else return l.get.call(null,l.keyword("rpub.lib.dag/values").call(null,e),n)})},R=function(n){const t=b.call(null,y),a=l.__destructure_map.call(null,t),c=l.get.call(null,a,l.keyword("dag-atom"));return g.call(null,function(){return l.select_keys.call(null,l.keyword("rpub.lib.dag/values").call(null,l.deref.call(null,c)),n)})};export{D as DAGProvider,I as __GT_Delay,A as delay,j as subscribe,k as updated_QMARK_,h as use_dag,R as use_dag_values,M as use_dispatch,K as use_sub,E as use_sub_deref};
