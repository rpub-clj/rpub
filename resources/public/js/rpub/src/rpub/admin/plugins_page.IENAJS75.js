import*as l from"cherry-cljs/cljs.core.js";import"preact/devtools";import*as f from"cherry-cljs/lib/clojure.string.js";import"rpub.admin.dashboard-page";import*as k from"rpub.admin.impl";import"rpub.admin.new-user-page";import"rpub.admin.settings-page";import"rpub.admin.themes-page";import"rpub.admin.users-page";import{use_dag as V}from"rpub.lib.dag.react";import*as g from"rpub.lib.html";import*as h from"rpub.lib.http";import"rpub.plugins.content-types.admin";var I=function(n,s){return l.update.call(null,l.assoc.call(null,n,l.keyword("plugins-page/needs-restart"),!0),l.keyword("plugins-page/activated-plugins"),l.fnil.call(null,l.conj,l.hash_set()),s)},M=function(n,s){return l.update.call(null,l.assoc.call(null,n,l.keyword("plugins-page/needs-restart"),!0),l.keyword("plugins-page/activated-plugins"),l.disj,s)},N=function(n){return l.assoc.call(null,n,l.keyword("plugins-page/restarted"),!0)},b=function(n){return l.vector(l.keyword("svg"),l.array_map(l.keyword("class"),"w-8 h-8 text-gray-500 mr-4",l.keyword("aria-hidden"),"true",l.keyword("xmlns"),"http://www.w3.org/2000/svg",l.keyword("width"),"24",l.keyword("height"),"24",l.keyword("fill"),"currentColor",l.keyword("viewBox"),"0 0 24 24"),l.vector(l.keyword("path"),l.array_map(l.keyword("fill-rule"),"evenodd",l.keyword("d"),"M13 11.15V4a1 1 0 1 0-2 0v7.15L8.78 8.374a1 1 0 1 0-1.56 1.25l4 5a1 1 0 0 0 1.56 0l4-5a1 1 0 1 0-1.56-1.25L13 11.15Z",l.keyword("clip-rule"),"evenodd")),l.vector(l.keyword("path"),l.array_map(l.keyword("fill-rule"),"evenodd",l.keyword("d"),"M9.657 15.874 7.358 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-2.358l-2.3 2.874a3 3 0 0 1-4.685 0ZM17 16a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2H17Z",l.keyword("clip-rule"),"evenodd")))},x=function(n){const s=f.split.call(null,l.keyword("key").call(null,n),/\//),p=l.nth.call(null,s,0,null),L=l.last.call(null,f.split.call(null,p,/\./));return l.str.call(null,"https://github.com/rpub-clj/plugins/tree/main/plugins/",L)},O=function(n){const s=n,p=l.__destructure_map.call(null,s),L=p,U=l.get.call(null,p,l.keyword("current-plugins")),j=l.get.call(null,p,l.keyword("available-plugins")),E=V.call(null,l.vector(l.keyword("plugins-page/needs-restart"),l.keyword("plugins-page/activated-plugins"))),q=l.nth.call(null,E,0,null),G=l.__destructure_map.call(null,q),A=l.get.call(null,G,l.keyword("plugins-page/needs-restart")),Z=l.get.call(null,G,l.keyword("plugins-page/activated-plugins")),m=l.nth.call(null,E,1,null),v=l.array_map(l.keyword("format"),l.keyword("transit")),z=k.index_by.call(null,l.keyword("key"),U),Q=function(_,a){const t=l.assoc.call(null,a,l.keyword("activated"),!0),d=l.array_map(l.keyword("plugin"),l.select_keys.call(null,t,l.vector(l.keyword("key")))),i=function(e,r){if(l.truth_.call(null,e))return m.call(null,l.keyword("plugins-page/activate-plugin"),l.keyword("key").call(null,t))},o=l.merge.call(null,v,l.array_map(l.keyword("body"),d,l.keyword("on-complete"),i));return h.post.call(null,"/admin/api/activate-plugin",o)},S=function(_,a){const t=l.array_map(l.keyword("plugin"),l.select_keys.call(null,a,l.vector(l.keyword("key")))),d=function(o,e){if(l.truth_.call(null,o))return m.call(null,l.keyword("plugins-page/deactivate-plugin"),l.keyword("key").call(null,a))},i=l.merge.call(null,v,l.array_map(l.keyword("body"),t,l.keyword("on-complete"),d));return h.post.call(null,"/admin/api/deactivate-plugin",i)},H=function(_){const a=function(d,i){return null},t=l.merge.call(null,v,l.array_map(l.keyword("on-complete"),a));return m.call(null,l.keyword("plugins-page/restart-server")),h.post.call(null,"/api/restart-server",t)},P=k.index_by.call(null,l.keyword("key"),j),B=l.into.call(null,l.array_map(),l.map.call(null,function(_){return l.vector(_,l.array_map(l.keyword("activated"),!0))},Z)),K=l.merge_with.call(null,l.merge,z,P,B);return l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"p-4"),l.vector(k.box,l.array_map(l.keyword("title"),"Plugins",l.keyword("class"),"mb-4",l.keyword("content"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"flex"),l.vector(l.keyword("p"),l.array_map(l.keyword("class"),"italic"),"Note: The server must be restarted after activating a plugin for the first time."),l.truth_.call(null,A)?l.vector(l.keyword("button"),l.array_map(l.keyword("class"),"font-app-sans inline-flex items-center px-5 py-2.5 text-sm font-medium text-center text-white bg-blue-700 rounded-lg focus:ring-4 focus:ring-primary-200 hover:bg-primary-800 shadow-sm ml-auto w-44",l.keyword("on-click"),H),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"inline-flex items-center mx-auto"),"Restart")):null))),function a(t){return new l.LazySeq(null,function(){let d=t;for(;;){const i=l.seq.call(null,d);if(l.truth_.call(null,i)){const o=i;if(l.truth_.call(null,l.chunked_seq_QMARK_.call(null,o))){const e=l.chunk_first.call(null,o),r=l.count.call(null,e),y=l.chunk_buffer.call(null,r);return(()=>{let w=0;for(;;){if(w<r){const u=l._nth.call(null,e,w);l.chunk_append.call(null,y,l.vector(k.box,l.array_map(l.keyword("key"),l.keyword("key").call(null,u),l.keyword("title"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"flex items-center",l.keyword("style"),l.array_map(l.keyword("margin-top"),"-1px")),l.vector(b),l.vector(l.keyword("a"),l.array_map(l.keyword("class"),"underline",l.keyword("href"),x.call(null,u),l.keyword("target"),"_blank"),(()=>{const c=l.keyword("label").call(null,u);return l.truth_.call(null,c)?c:l.keyword("key").call(null,u)})()),l.truth_.call(null,l.keyword("activated").call(null,u))?l.vector(g.activated_button,l.array_map(l.keyword("on-click"),function(c){return S.call(null,c,u)})):l.vector(g.activate_button,l.array_map(l.keyword("label"),"Activate Plugin",l.keyword("on-click"),function(c){return Q.call(null,c,u)}))),l.keyword("class"),"mb-4",l.keyword("content"),l.vector(l.keyword("div"),(()=>{const c=l.keyword("description").call(null,u);if(l.truth_.call(null,c)){const R=c;return l.vector(l.keyword("p"),R)}})())))),w=l.unchecked_inc.call(null,w);continue}else return!0;break}})()?l.chunk_cons.call(null,l.chunk.call(null,y),a.call(null,l.chunk_rest.call(null,o))):l.chunk_cons.call(null,l.chunk.call(null,y),null)}else{const e=l.first.call(null,o);return l.cons.call(null,l.vector(k.box,l.array_map(l.keyword("key"),l.keyword("key").call(null,e),l.keyword("title"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"flex items-center",l.keyword("style"),l.array_map(l.keyword("margin-top"),"-1px")),l.vector(b),l.vector(l.keyword("a"),l.array_map(l.keyword("class"),"underline",l.keyword("href"),x.call(null,e),l.keyword("target"),"_blank"),(()=>{const r=l.keyword("label").call(null,e);return l.truth_.call(null,r)?r:l.keyword("key").call(null,e)})()),l.truth_.call(null,l.keyword("activated").call(null,e))?l.vector(g.activated_button,l.array_map(l.keyword("on-click"),function(r){return S.call(null,r,e)})):l.vector(g.activate_button,l.array_map(l.keyword("label"),"Activate Plugin",l.keyword("on-click"),function(r){return Q.call(null,r,e)}))),l.keyword("class"),"mb-4",l.keyword("content"),l.vector(l.keyword("div"),(()=>{const r=l.keyword("description").call(null,e);if(l.truth_.call(null,r)){const y=r;return l.vector(l.keyword("p"),y)}})()))),a.call(null,l.rest.call(null,o)))}}break}},null,null)}.call(null,l.sort_by.call(null,function(a){return f.lower_case.call(null,(()=>{const t=l.keyword("label").call(null,a);return l.truth_.call(null,t)?t:l.keyword("key").call(null,a)})())},l.vals.call(null,K))))},T=l.array_map(l.keyword("nodes"),l.array_map(l.keyword("plugins-page/needs-restart"),l.array_map(l.keyword("calc"),l.keyword("plugins-page/needs-restart")),l.keyword("plugins-page/restart-server"),l.array_map(l.keyword("push"),N),l.keyword("plugins-page/activated-plugins"),l.array_map(l.keyword("calc"),l.keyword("plugins-page/activated-plugins")),l.keyword("plugins-page/activate-plugin"),l.array_map(l.keyword("push"),I),l.keyword("plugins-page/deactivate-plugin"),l.array_map(l.keyword("push"),M)),l.keyword("edges"),l.vector(l.vector(l.keyword("plugins-page/activate-plugin"),l.keyword("plugins-page/needs-restart")),l.vector(l.keyword("plugins-page/activate-plugin"),l.keyword("plugins-page/activated-plugins")),l.vector(l.keyword("plugins-page/deactivate-plugin"),l.keyword("plugins-page/needs-restart")),l.vector(l.keyword("plugins-page/deactivate-plugin"),l.keyword("plugins-page/activated-plugins")))),C=l.array_map(l.keyword("page-id"),l.keyword("plugins-page"),l.keyword("component"),O,l.keyword("dag-config"),T);export{I as activate_plugin,C as config,T as dag_config,M as deactivate_plugin,O as page,b as plugin_icon,x as plugin_url,N as restart_server};
