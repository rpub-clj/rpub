import*as l from"cherry-cljs/cljs.core.js";import{useEffect as S}from"react";import{use_dag as h,use_dag_values as T}from"rpub.lib.dag.react";import*as G from"rpub.lib.forms";import*as _ from"rpub.lib.html";import*as g from"rpub.lib.http";import*as f from"rpub.plugins.admin.helpers";var b=l.array_map(l.keyword("label"),l.array_map(l.keyword("valid"),function(t){const e=l.string_QMARK_.call(null,t);return l.truth_.call(null,e)?l.seq.call(null,t):e},l.keyword("message"),"Required"),l.keyword("html-template"),l.array_map(l.keyword("valid"),function(t){const e=l.string_QMARK_.call(null,t);return l.truth_.call(null,e)?l.seq.call(null,t):e},l.keyword("message"),"Required")),x=function(t){const e=t,n=l.__destructure_map.call(null,e),r=l.get.call(null,n,l.keyword("value")),a=l.get.call(null,n,l.keyword("valid")),o=l.get.call(null,n,l.keyword("on-change"));return l.vector(l.keyword("textarea"),l.array_map(l.keyword("class"),l.str.call(null,"w-full min-h-96 font-app-mono text-sm rounded-[6px] ",l.truth_.call(null,a)?"border-gray-300 focus:ring-primary-600 focus:border-blue-600":"bg-red-50 border-red-500 focus:ring-red-500"),l.keyword("value"),r,l.keyword("on-change"),o))},v=function(t){const e=t,n=l.__destructure_map.call(null,e),r=l.get.call(null,n,l.keyword("field-config")),a=l.get.call(null,n,l.keyword("input-component")),o=h.call(null,l.vector(l.vector(l.keyword("rpub.plugins.admin.themes.single-theme-page/field-values"),l.vector(l.keyword("key").call(null,r))))),c=l.nth.call(null,o,0,null),u=l.nth.call(null,o,1,null),m=l.get.call(null,c,l.vector(l.keyword("rpub.plugins.admin.themes.single-theme-page/field-values"),l.vector(l.keyword("key").call(null,r)))),s=l.get.call(null,m,l.keyword("key").call(null,r)),p=s,i=l.__destructure_map.call(null,p),w=l.get.call(null,i,l.keyword("message")),k=l.get.call(null,i,l.keyword("valid")),y=l.get.call(null,s,l.keyword("value"),l.keyword("value").call(null,r)),Q=function(d,R){const D=R.target.value;return u.call(null,l.keyword("rpub.plugins.admin.themes.single-theme-page/change-input"),l.vector(d,D))};return l.vector(l.keyword("div"),l.array_map(l.keyword("key"),l.str.call(null,l.keyword("key").call(null,r)),l.keyword("class"),"sm:col-span-2"),l.vector(l.keyword("label"),l.array_map(l.keyword("class"),"block mb-2 text-sm text-gray-900",l.keyword("for"),"label"),l.vector(l.keyword("span"),l.array_map(l.keyword("class"),"font-semibold"),l.keyword("label").call(null,r)),l.truth_.call(null,w)?l.vector(l.keyword("span"),l.array_map(l.keyword("class"),"text-red-500")," - ",w):null),l.vector(a,l.array_map(l.keyword("type"),l.keyword("type").call(null,r),l.keyword("valid"),(()=>{const d=k;return l.truth_.call(null,d)?d:l.not.call(null,l.contains_QMARK_.call(null,s,l.keyword("value")))})(),l.keyword("name"),l.keyword("key").call(null,r),l.keyword("value"),y,l.keyword("on-change"),function(d){return Q.call(null,l.keyword("key").call(null,r),d)})))},q=function(t,e,n){t.preventDefault();const r=n.call(null),a=l.__destructure_map.call(null,r),o=l.get.call(null,a,l.keyword("rpub.plugins.admin.themes.single-theme-page/field-values")),c=l.array_map(l.keyword("theme"),l.dissoc.call(null,l.assoc.call(null,l.merge.call(null,e,l.update_vals.call(null,l.keyword("value"),o)),l.keyword("value"),l.array_map(l.keyword("html-template"),(()=>{const u=l.keyword("html-template").call(null,o);return l.truth_.call(null,u)?u:l.get_in.call(null,e,l.vector(l.keyword("value"),l.keyword("html-template")))})())),l.keyword("html-template")));return l.truth_.call(null,l.keyword("new").call(null,e))?g.post.call(null,"/admin/api/create-theme",l.array_map(l.keyword("body"),c)).then(function(u){return window.location="/admin/themes"}):g.post.call(null,"/admin/api/update-theme",l.array_map(l.keyword("body"),c)).then(function(u){return window.location.reload()})},A=function(t,e){const n=l.str.call(null,'Are you sure want to delete the "',l.keyword("label").call(null,e),'" theme?');if(l.truth_.call(null,confirm(n))){const r=l.select_keys.call(null,e,l.vector(l.keyword("id")));return g.post.call(null,"/admin/api/delete-theme",l.array_map(l.keyword("body"),r)).then(function(a){return window.location="/admin/themes"})}},M=function(t){const e=t,n=l.__destructure_map.call(null,e),r=n,a=l.get.call(null,n,l.keyword("theme")),o=h.call(null,l.vector(l.keyword("rpub.plugins.admin.themes.single-theme-page/submitting"),l.keyword("rpub.plugins.admin.themes.single-theme-page/ready-to-submit"))),c=l.nth.call(null,o,0,null),u=l.__destructure_map.call(null,c),m=l.get.call(null,u,l.keyword("rpub.plugins.admin.themes.single-theme-page/submitting")),s=l.get.call(null,u,l.keyword("rpub.plugins.admin.themes.single-theme-page/ready-to-submit")),p=l.nth.call(null,o,1,null),i=T.call(null,l.vector(l.keyword("rpub.plugins.admin.themes.single-theme-page/field-values"))),w=S.call(null,function(){return p.call(null,l.keyword("rpub.plugins.admin.themes.single-theme-page/init"),r)},[]),k=l.get_in.call(null,a,l.vector(l.keyword("value"),l.keyword("html-template")));return l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"p-4"),l.vector(f.box,l.array_map(l.keyword("class"),"mb-4",l.keyword("title"),l.vector(l.keyword("div.flex"),l.vector(l.keyword("div.grow"),l.truth_.call(null,l.keyword("new").call(null,a))?"New Theme":l.vector(l.keyword("div"),l.vector(l.keyword("span.italic.text-blue-600"),"Theme: "),l.keyword("label").call(null,a))),l.vector(l.keyword("div"),l.truth_.call(null,l.keyword("new").call(null,a))?null:l.vector(_.delete_button,l.array_map(l.keyword("on-click"),function(y){return A.call(null,y,a)}),"Delete"))))),l.vector(f.box,l.array_map(l.keyword("content"),l.vector(l.keyword("form"),l.array_map(l.keyword("on-submit"),function(y){return q.call(null,y,a,i)}),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"grid gap-4 sm:grid-cols-2 sm:gap-6"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"max-w-2xl"),l.vector(v,l.array_map(l.keyword("field-config"),l.array_map(l.keyword("key"),l.keyword("label"),l.keyword("label"),"Name",l.keyword("type"),l.keyword("text"),l.keyword("value"),l.keyword("label").call(null,a)),l.keyword("input-component"),_.input2))),l.vector(v,l.array_map(l.keyword("field-config"),l.array_map(l.keyword("key"),l.keyword("html-template"),l.keyword("label"),"HTML",l.keyword("value"),k),l.keyword("input-component"),x))),l.truth_.call(null,l.keyword("new").call(null,a))?l.vector(_.submit_button,l.array_map(l.keyword("ready-label"),"Create",l.keyword("submit-label"),"Creating...",l.keyword("disabled"),l.not.call(null,s),l.keyword("submitting"),m)):l.vector(_.submit_button,l.array_map(l.keyword("ready-label"),"Save",l.keyword("submit-label"),"Saving...",l.keyword("submitting"),m))))))},K=G.__GT_dag.call(null,l.keyword("rpub.plugins.admin.themes.single-theme-page/form"),b),H=l.array_map(l.keyword("page-id"),l.keyword("single-theme-page"),l.keyword("component"),M,l.keyword("dag-config"),K);export{H as config,K as dag_config,v as field,b as form_schema,A as handle_delete,x as html_input,M as page,q as submit_form};
