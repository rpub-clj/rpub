import*as l from"cherry-cljs/cljs.core.js";import{useEffect as g}from"react";import*as w from"rpub.lib.forms";import*as c from"rpub.lib.html";import*as y from"rpub.lib.http";import{subscribe as m,dispatch as x}from"rpub.lib.substrate";import*as k from"rpub.plugins.admin.helpers";var _=l.array_map(l.keyword("label"),l.array_map(l.keyword("valid"),function(r){const e=l.string_QMARK_.call(null,r);return l.truth_.call(null,e)?l.seq.call(null,r):e},l.keyword("message"),"Required"),l.keyword("html-template"),l.array_map(l.keyword("valid"),function(r){const e=l.string_QMARK_.call(null,r);return l.truth_.call(null,e)?l.seq.call(null,r):e},l.keyword("message"),"Required")),p=function(r){const e=r,o=l.__destructure_map.call(null,e),d=l.get.call(null,o,l.keyword("value")),a=l.get.call(null,o,l.keyword("valid")),t=l.get.call(null,o,l.keyword("on-change"));return l.vector(l.keyword("textarea"),l.array_map(l.keyword("class"),l.str.call(null,"w-full min-h-96 font-app-mono text-sm rounded-[6px] ",l.truth_.call(null,a)?"border-gray-300 focus:ring-primary-600 focus:border-blue-600":"bg-red-50 border-red-500 focus:ring-red-500"),l.keyword("value"),d,l.keyword("on-change"),t))},b=function(r,e,o){r.preventDefault();const d=l.keyword("label").call(null,o),a=l.keyword("html-template").call(null,o),t=l.array_map(l.keyword("theme"),l.dissoc.call(null,l.assoc.call(null,l.assoc.call(null,e,l.keyword("label"),l.keyword("value").call(null,d)),l.keyword("value"),l.array_map(l.keyword("html-template"),(()=>{const n=l.keyword("value").call(null,a);return l.truth_.call(null,n)?n:l.get_in.call(null,e,l.vector(l.keyword("value"),l.keyword("html-template")))})())),l.keyword("html-template")));return l.truth_.call(null,l.keyword("new").call(null,e))?y.post.call(null,"/admin/api/create-theme",l.array_map(l.keyword("body"),t)).then(function(n){return window.location="/admin/themes"}):y.post.call(null,"/admin/api/update-theme",l.array_map(l.keyword("body"),t)).then(function(n){return window.location.reload()})},f=function(r,e){const o=l.str.call(null,'Are you sure want to delete the "',l.keyword("label").call(null,e),'" theme?');if(l.truth_.call(null,confirm(o))){const d=l.select_keys.call(null,e,l.vector(l.keyword("id")));return y.post.call(null,"/admin/api/delete-theme",l.array_map(l.keyword("body"),d)).then(function(a){return window.location="/admin/themes"})}},v=function(r){return l.array_map(l.keyword("id"),l.keyword("rpub.plugins.admin.themes.single-theme-page/form"),l.keyword("schema"),_,l.keyword("initial-values"),l.array_map(l.keyword("label"),l.keyword("label").call(null,r),l.keyword("html-template"),l.get_in.call(null,r,l.vector(l.keyword("value"),l.keyword("html-template")))))},h=function(r){const e=r,o=l.__destructure_map.call(null,e),d=o,a=l.get.call(null,o,l.keyword("theme")),t=v.call(null,a),n=m.call(null,l.vector(l.keyword("rpub.lib.forms/submitting"),t)),i=m.call(null,l.vector(l.keyword("rpub.lib.forms/ready-to-submit"),t)),s=m.call(null,l.vector(l.keyword("rpub.lib.forms/field-values"),t)),A=g.call(null,function(){return x.call(null,l.vector(l.keyword("rpub.lib.forms/init"),t))},[]);return l.prn.call(null,l.symbol.call(null,"page"),l.array_map(l.keyword("field-values"),s)),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"p-4"),l.vector(k.box,l.array_map(l.keyword("class"),"mb-4",l.keyword("title"),l.vector(l.keyword("div.flex"),l.vector(l.keyword("div.grow"),l.truth_.call(null,l.keyword("new").call(null,a))?"New Theme":l.vector(l.keyword("div"),l.vector(l.keyword("span.italic.text-blue-600"),"Theme: "),l.keyword("label").call(null,a))),l.vector(l.keyword("div"),l.truth_.call(null,l.keyword("new").call(null,a))?null:l.vector(c.delete_button,l.array_map(l.keyword("on-click"),function(u){return f.call(null,u,a)}),"Delete"))))),l.vector(k.box,l.array_map(l.keyword("content"),l.vector(l.keyword("form"),l.array_map(l.keyword("on-submit"),function(u){return b.call(null,u,a,s)}),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"grid gap-4 sm:grid-cols-2 sm:gap-6"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"max-w-2xl"),l.vector(w.field,l.array_map(l.keyword("form"),t,l.keyword("field-config"),l.array_map(l.keyword("key"),l.keyword("label"),l.keyword("label"),"Name",l.keyword("type"),l.keyword("text")),l.keyword("input-component"),c.input2))),l.vector(w.field,l.array_map(l.keyword("form"),t,l.keyword("field-config"),l.array_map(l.keyword("key"),l.keyword("html-template"),l.keyword("label"),"HTML"),l.keyword("input-component"),p))),l.truth_.call(null,l.keyword("new").call(null,a))?l.vector(c.submit_button,l.array_map(l.keyword("ready-label"),"Create",l.keyword("submit-label"),"Creating...",l.keyword("disabled"),l.not.call(null,i),l.keyword("submitting"),n)):l.vector(c.submit_button,l.array_map(l.keyword("ready-label"),"Save",l.keyword("submit-label"),"Saving...",l.keyword("disabled"),l.not.call(null,i),l.keyword("submitting"),n))))))},q=l.array_map(l.keyword("page-id"),l.keyword("single-theme-page"),l.keyword("component"),h);export{v as __GT_form,q as config,_ as form_schema,f as handle_delete,p as html_input,h as page,b as submit_form};
