import*as l from"cherry-cljs/cljs.core.js";import{use_dag as R}from"rpub.lib.dag.react";import*as w from"rpub.lib.html";import*as j from"rpub.lib.http";import*as b from"rpub.plugins.admin.helpers";var z=function(r){const y=r,o=l.__destructure_map.call(null,y),v=o,p=l.get.call(null,o,l.keyword("settings")),f=R.call(null,l.vector(l.keyword("rpub.plugins.admin.settings.page/field-values"),l.keyword("rpub.plugins.admin.settings.page/submitting"))),L=l.nth.call(null,f,0,null),h=l.__destructure_map.call(null,L),_=l.get.call(null,h,l.keyword("rpub.plugins.admin.settings.page/field-values")),M=l.get.call(null,h,l.keyword("rpub.plugins.admin.settings.page/submitting")),k=l.nth.call(null,f,1,null),x=b.index_by.call(null,l.keyword("key"),p),S=function(c,u){const n=u.target.value;return k.call(null,l.keyword("rpub.plugins.admin.settings.page/change-input"),l.vector(c,n))},Q=function(c){c.preventDefault(),k.call(null,l.keyword("rpub.plugins.admin.settings.page/submit-start"));const u=l.vals.call(null,l.update_vals.call(null,l.merge_with.call(null,function(n,g){return l.assoc.call(null,n,l.keyword("value"),g)},x,_),function(n){return l.select_keys.call(null,n,l.vector(l.keyword("key"),l.keyword("value")))}));return j.post.call(null,"/admin/api/update-settings",l.array_map(l.keyword("body"),l.array_map(l.keyword("settings"),u))).then(function(){return window.location.reload()}).catch(function(n){return k.call(null,l.keyword("rpub.plugins.admin.settings.page/submit-error"))})};return l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"p-4"),l.vector(b.box,l.array_map(l.keyword("title"),"Settings",l.keyword("content"),l.vector(l.keyword("section"),l.array_map(l.keyword("class"),"bg-white"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"max-w-2xl"),l.vector(l.keyword("form"),l.array_map(l.keyword("on-submit"),Q),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"grid gap-4 sm:grid-cols-2 sm:gap-6"),function u(n){return new l.LazySeq(null,function(){let g=n;for(;;){const q=l.seq.call(null,g);if(l.truth_.call(null,q)){const s=q;if(l.truth_.call(null,l.chunked_seq_QMARK_.call(null,s))){const e=l.chunk_first.call(null,s),t=l.count.call(null,e),m=l.chunk_buffer.call(null,t);return(()=>{let i=0;for(;;){if(i<t){const a=l._nth.call(null,e,i);l.chunk_append.call(null,m,l.vector(l.keyword("div"),l.array_map(l.keyword("key"),l.keyword("key").call(null,a),l.keyword("class"),"sm:col-span-2"),l.vector(l.keyword("label"),l.array_map(l.keyword("class"),"block mb-2 text-sm font-semibold text-gray-900",l.keyword("for"),"name"),l.keyword("label").call(null,a)),l.prn.call(null,a),l.vector(w.input2,l.array_map(l.keyword("type"),l.keyword("text"),l.keyword("name"),l.keyword("key").call(null,a),l.keyword("value"),(()=>{const d=l.get.call(null,_,l.keyword("key").call(null,a));return l.truth_.call(null,d)?d:l.keyword("value").call(null,a)})(),l.keyword("on-change"),function(d){return S.call(null,l.keyword("key").call(null,a),d)})))),i=l.unchecked_inc.call(null,i);continue}else return!0;break}})()?l.chunk_cons.call(null,l.chunk.call(null,m),u.call(null,l.chunk_rest.call(null,s))):l.chunk_cons.call(null,l.chunk.call(null,m),null)}else{const e=l.first.call(null,s);return l.cons.call(null,l.vector(l.keyword("div"),l.array_map(l.keyword("key"),l.keyword("key").call(null,e),l.keyword("class"),"sm:col-span-2"),l.vector(l.keyword("label"),l.array_map(l.keyword("class"),"block mb-2 text-sm font-semibold text-gray-900",l.keyword("for"),"name"),l.keyword("label").call(null,e)),l.prn.call(null,e),l.vector(w.input2,l.array_map(l.keyword("type"),l.keyword("text"),l.keyword("name"),l.keyword("key").call(null,e),l.keyword("value"),(()=>{const t=l.get.call(null,_,l.keyword("key").call(null,e));return l.truth_.call(null,t)?t:l.keyword("value").call(null,e)})(),l.keyword("on-change"),function(t){return S.call(null,l.keyword("key").call(null,e),t)}))),u.call(null,l.rest.call(null,s)))}}break}},null,null)}.call(null,l.sort_by.call(null,l.keyword("label"),l.vals.call(null,x))),l.vector(w.submit_button,l.array_map(l.keyword("ready-label"),"Save",l.keyword("submit-label"),"Saving...",l.keyword("submitting"),M)))))))))},G=function(r,y){const o=y,v=l.nth.call(null,o,0,null),p=l.nth.call(null,o,1,null);return l.assoc_in.call(null,r,l.vector(l.keyword("inputs"),v,l.keyword("value")),p)},A=function(r){return l.assoc.call(null,r,l.keyword("rpub.plugins.admin.settings.page/submitting"),!0)},D=function(r){return l.assoc.call(null,r,l.keyword("rpub.plugins.admin.settings.page/submitting"),!1)},K=l.array_map(l.keyword("nodes"),l.array_map(l.keyword("rpub.plugins.admin.settings.page/change-input"),l.array_map(l.keyword("push"),G),l.keyword("rpub.plugins.admin.settings.page/field-values"),l.array_map(l.keyword("calc"),b.field_values),l.keyword("rpub.plugins.admin.settings.page/submit-error"),l.array_map(l.keyword("push"),D),l.keyword("rpub.plugins.admin.settings.page/submit-start"),l.array_map(l.keyword("push"),A),l.keyword("rpub.plugins.admin.settings.page/submitting"),l.array_map(l.keyword("calc"),l.keyword("rpub.plugins.admin.settings.page/submitting"))),l.keyword("edges"),l.vector(l.vector(l.keyword("rpub.plugins.admin.settings.page/change-input"),l.keyword("rpub.plugins.admin.settings.page/field-values")),l.vector(l.keyword("rpub.plugins.admin.settings.page/submit-error"),l.keyword("rpub.plugins.admin.settings.page/submitting")),l.vector(l.keyword("rpub.plugins.admin.settings.page/submit-start"),l.keyword("rpub.plugins.admin.settings.page/submitting")))),B=l.array_map(l.keyword("page-id"),l.keyword("settings-page"),l.keyword("component"),z,l.keyword("dag-config"),K);export{G as change_input,B as config,K as dag_config,z as page,D as submit_error,A as submit_start};
