import*as l from"cherry-cljs/cljs.core.js";import{useEffect as R}from"react";import{use_dag as M}from"rpub.lib.dag.react";import*as U from"rpub.lib.forms";import*as q from"rpub.lib.html";import*as D from"rpub.lib.http";import*as L from"rpub.plugins.admin.helpers";var A=l.array_map(l.keyword("username"),l.array_map(l.keyword("valid"),function(r){const n=l.string_QMARK_.call(null,r);if(l.truth_.call(null,n)){const e=l.seq.call(null,r);return l.truth_.call(null,e)?l.count.call(null,r)>=3:e}else return n},l.keyword("message"),"Must be at least 3 characters"),l.keyword("password"),l.array_map(l.keyword("valid"),function(r){const n=l.string_QMARK_.call(null,r);if(l.truth_.call(null,n)){const e=l.seq.call(null,r);return l.truth_.call(null,e)?l.count.call(null,r)>=6:e}else return n},l.keyword("message"),"Must be at least 6 characters"),l.keyword("roles"),l.array_map(l.keyword("valid"),function(r){const n=l.string_QMARK_.call(null,r);return l.truth_.call(null,n)?l.seq.call(null,r):n},l.keyword("message"),"Required")),h=function(r){const n=r,e=l.__destructure_map.call(null,n),a=l.get.call(null,e,l.keyword("value")),u=l.get.call(null,e,l.keyword("valid")),o=l.get.call(null,e,l.keyword("on-change")),c=l.get.call(null,e,l.keyword("type")),y=l.get.call(null,e,l.keyword("name"));return l.vector(q.input2,l.array_map(l.keyword("type"),c,l.keyword("name"),y,l.keyword("value"),a,l.keyword("class"),l.truth_.call(null,l.false_QMARK_.call(null,u))?"border-red-500":"",l.keyword("on-change"),o))},b=function(r){const n=r,e=l.__destructure_map.call(null,n),a=l.get.call(null,e,l.keyword("field-config")),u=l.get.call(null,e,l.keyword("input-component")),o=M.call(null,l.vector(l.vector(l.keyword("rpub.plugins.admin.users.single-user-page/field-values"),l.vector(l.keyword("key").call(null,a))))),c=l.nth.call(null,o,0,null),y=l.nth.call(null,o,1,null),f=l.get.call(null,c,l.vector(l.keyword("rpub.plugins.admin.users.single-user-page/field-values"),l.vector(l.keyword("key").call(null,a)))),d=l.get.call(null,f,l.keyword("key").call(null,a)),k=d,s=l.__destructure_map.call(null,k),p=l.get.call(null,s,l.keyword("message")),v=l.get.call(null,s,l.keyword("valid")),w=l.get.call(null,d,l.keyword("value"),l.keyword("value").call(null,a)),_=function(t,m){const i=m.target.value;return y.call(null,l.keyword("rpub.plugins.admin.users.single-user-page/change-input"),l.vector(t,i))};return l.vector(l.keyword("div"),l.array_map(l.keyword("key"),l.str.call(null,l.keyword("key").call(null,a)),l.keyword("class"),"sm:col-span-2"),l.vector(l.keyword("label"),l.array_map(l.keyword("class"),"block mb-2 text-sm text-gray-900",l.keyword("for"),"label"),l.vector(l.keyword("span"),l.array_map(l.keyword("class"),"font-semibold"),l.keyword("label").call(null,a)),l.truth_.call(null,p)?l.vector(l.keyword("span"),l.array_map(l.keyword("class"),"text-red-500")," - ",p):null),l.vector(u,l.array_map(l.keyword("type"),l.keyword("type").call(null,a),l.keyword("valid"),(()=>{const t=v;return l.truth_.call(null,t)?t:l.not.call(null,l.contains_QMARK_.call(null,d,l.keyword("value")))})(),l.keyword("name"),l.keyword("key").call(null,a),l.keyword("value"),w,l.keyword("on-change"),function(t){return _.call(null,l.keyword("key").call(null,a),t)})))},K=function(r){const n=M.call(null,l.vector(l.keyword("rpub.plugins.admin.users.single-user-page/submitting"),l.keyword("rpub.plugins.admin.users.single-user-page/ready-to-submit"))),e=l.nth.call(null,n,0,null),a=l.__destructure_map.call(null,e),u=l.get.call(null,a,l.keyword("rpub.plugins.admin.users.single-user-page/submitting")),o=l.get.call(null,a,l.keyword("rpub.plugins.admin.users.single-user-page/ready-to-submit")),c=l.nth.call(null,n,1,null),y=R.call(null,function(){return c.call(null,l.keyword("rpub.plugins.admin.users.single-user-page/init"))},[]),f=function(k){if(k.preventDefault(),l.truth_.call(null,o))return c.call(null,l.keyword("rpub.plugins.admin.users.single-user-page/submit-start")),D.post.call(null,"/admin/api/create-user",l.array_map(l.keyword("body"),l.array_map())).then(function(s){return window.location.reload()}).catch(function(s){return c.call(null,l.keyword("rpub.plugins.admin.users.single-user-page/submit-error"))})},d=l.vector(l.array_map(l.keyword("key"),l.keyword("username"),l.keyword("label"),"Username",l.keyword("type"),l.keyword("text")),l.array_map(l.keyword("key"),l.keyword("password"),l.keyword("label"),"Password",l.keyword("type"),l.keyword("password")));return l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"p-4"),l.vector(L.box,l.array_map(l.keyword("title"),"New User",l.keyword("content"),l.vector(l.keyword("section"),l.array_map(l.keyword("class"),"bg-white"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"max-w-2xl"),l.vector(l.keyword("form"),l.array_map(l.keyword("on-submit"),f),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"grid gap-4 sm:grid-cols-2 sm:gap-6"),function s(p){return new l.LazySeq(null,function(){let v=p;for(;;){const w=l.seq.call(null,v);if(l.truth_.call(null,w)){const _=w;if(l.truth_.call(null,l.chunked_seq_QMARK_.call(null,_))){const t=l.chunk_first.call(null,_),m=l.count.call(null,t),i=l.chunk_buffer.call(null,m);return(()=>{let g=0;for(;;){if(g<m){const x=l._nth.call(null,t,g);l.chunk_append.call(null,i,l.vector(b,l.array_map(l.keyword("key"),l.keyword("key").call(null,x),l.keyword("field-config"),x,l.keyword("input-component"),h))),g=l.unchecked_inc.call(null,g);continue}else return!0;break}})()?l.chunk_cons.call(null,l.chunk.call(null,i),s.call(null,l.chunk_rest.call(null,_))):l.chunk_cons.call(null,l.chunk.call(null,i),null)}else{const t=l.first.call(null,_);return l.cons.call(null,l.vector(b,l.array_map(l.keyword("key"),l.keyword("key").call(null,t),l.keyword("field-config"),t,l.keyword("input-component"),h)),s.call(null,l.rest.call(null,_)))}}break}},null,null)}.call(null,d),l.vector(q.submit_button,l.array_map(l.keyword("ready-label"),"Create",l.keyword("submit-label"),"Creating...",l.keyword("submitting"),u,l.keyword("disabled"),l.not.call(null,o))))))))))},Q=function(r){return null},G=function(r){const n=r,e=l.__destructure_map.call(null,n),a=e,u=l.get.call(null,e,l.keyword("editing"));return l.truth_.call(null,u)?l.vector(Q,a):l.vector(K,a)},z=U.__GT_dag.call(null,l.keyword("rpub.plugins.admin.users.single-user-page/form"),A),S=l.array_map(l.keyword("page-id"),l.keyword("single-user-page"),l.keyword("component"),G,l.keyword("dag-config"),z);export{S as config,z as dag_config,Q as edit_user_page,b as field,A as form_schema,h as html_input,K as new_user_page,G as single_user_page};
