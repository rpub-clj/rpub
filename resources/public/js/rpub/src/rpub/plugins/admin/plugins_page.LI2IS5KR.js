import*as l from"cherry-cljs/cljs.core.js";import*as v from"cherry-cljs/lib/clojure.string.js";import{use_dag as C}from"rpub.lib.dag.react";import*as g from"rpub.lib.html";import*as b from"rpub.lib.http";import*as y from"rpub.plugins.admin.impl";var f=function(a){return l.vector(l.keyword("svg"),l.array_map(l.keyword("class"),"w-8 h-8 text-gray-500 mr-4",l.keyword("aria-hidden"),"true",l.keyword("xmlns"),"http://www.w3.org/2000/svg",l.keyword("width"),"24",l.keyword("height"),"24",l.keyword("fill"),"currentColor",l.keyword("viewBox"),"0 0 24 24"),l.vector(l.keyword("path"),l.array_map(l.keyword("fill-rule"),"evenodd",l.keyword("d"),"M13 11.15V4a1 1 0 1 0-2 0v7.15L8.78 8.374a1 1 0 1 0-1.56 1.25l4 5a1 1 0 0 0 1.56 0l4-5a1 1 0 1 0-1.56-1.25L13 11.15Z",l.keyword("clip-rule"),"evenodd")),l.vector(l.keyword("path"),l.array_map(l.keyword("fill-rule"),"evenodd",l.keyword("d"),"M9.657 15.874 7.358 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-2.358l-2.3 2.874a3 3 0 0 1-4.685 0ZM17 16a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2H17Z",l.keyword("clip-rule"),"evenodd")))},h=function(a){const c=v.split.call(null,l.keyword("key").call(null,a),/\//),i=l.nth.call(null,c,0,null),x=l.last.call(null,v.split.call(null,i,/\./));return l.str.call(null,"https://github.com/rpub-clj/plugins/tree/main/plugins/",x)},A=function(a){const c=a,i=l.__destructure_map.call(null,c),x=i,Q=l.get.call(null,i,l.keyword("current-plugins")),S=l.get.call(null,i,l.keyword("available-plugins")),L=C.call(null,l.vector(l.keyword("rpub.plugins.admin.plugins-page/needs-restart"),l.keyword("rpub.plugins.admin.plugins-page/activated-plugins"))),B=l.nth.call(null,L,0,null),M=l.__destructure_map.call(null,B),I=l.get.call(null,M,l.keyword("rpub.plugins.admin.plugins-page/needs-restart")),K=l.get.call(null,M,l.keyword("rpub.plugins.admin.plugins-page/activated-plugins")),w=l.nth.call(null,L,1,null),N=y.index_by.call(null,l.keyword("key"),Q),j=function(p,n){const t=l.assoc.call(null,n,l.keyword("activated"),!0),_=l.array_map(l.keyword("plugin"),l.select_keys.call(null,t,l.vector(l.keyword("key"))));return b.post.call(null,"/admin/api/activate-plugin",l.array_map(l.keyword("body"),_)).then(function(m){return w.call(null,l.keyword("rpub.plugins.admin.plugins-page/activate-plugin"),l.keyword("key").call(null,t))})},q=function(p,n){const t=l.array_map(l.keyword("plugin"),l.select_keys.call(null,n,l.vector(l.keyword("key"))));return b.post.call(null,"/admin/api/deactivate-plugin",l.array_map(l.keyword("body"),t)).then(function(_){return w.call(null,l.keyword("rpub.plugins.admin.plugins-page/deactivate-plugin"),l.keyword("key").call(null,n))})},O=function(p){return w.call(null,l.keyword("rpub.plugins.admin.plugins-page/restart-server")),b.post.call(null,"/api/restart-server",l.array_map())},R=y.index_by.call(null,l.keyword("key"),S),T=l.into.call(null,l.array_map(),l.map.call(null,function(p){return l.vector(p,l.array_map(l.keyword("activated"),!0))},K)),U=l.merge_with.call(null,l.merge,N,R,T);return l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"p-4"),l.vector(y.box,l.array_map(l.keyword("title"),"Plugins",l.keyword("class"),"mb-4",l.keyword("content"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"flex"),l.vector(l.keyword("p"),l.array_map(l.keyword("class"),"italic"),"Note: The server must be restarted after activating a plugin for the first time."),l.truth_.call(null,I)?l.vector(l.keyword("button"),l.array_map(l.keyword("class"),"font-app-sans inline-flex items-center px-5 py-2.5 text-sm font-medium text-center text-white bg-blue-700 rounded-lg focus:ring-4 focus:ring-primary-200 hover:bg-primary-800 shadow-sm ml-auto w-44",l.keyword("on-click"),O),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"inline-flex items-center mx-auto"),"Restart")):null))),function n(t){return new l.LazySeq(null,function(){let _=t;for(;;){const m=l.seq.call(null,_);if(l.truth_.call(null,m)){const s=m;if(l.truth_.call(null,l.chunked_seq_QMARK_.call(null,s))){const r=l.chunk_first.call(null,s),e=l.count.call(null,r),d=l.chunk_buffer.call(null,e);return(()=>{let k=0;for(;;){if(k<e){const o=l._nth.call(null,r,k);l.chunk_append.call(null,d,l.vector(y.box,l.array_map(l.keyword("key"),l.keyword("key").call(null,o),l.keyword("title"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"flex items-center",l.keyword("style"),l.array_map(l.keyword("margin-top"),"-1px")),l.vector(f),l.vector(l.keyword("a"),l.array_map(l.keyword("class"),"underline",l.keyword("href"),h.call(null,o),l.keyword("target"),"_blank"),(()=>{const u=l.keyword("label").call(null,o);return l.truth_.call(null,u)?u:l.keyword("key").call(null,o)})()),l.truth_.call(null,l.keyword("activated").call(null,o))?l.vector(g.activated_button,l.array_map(l.keyword("on-click"),function(u){return q.call(null,u,o)})):l.vector(g.activate_button,l.array_map(l.keyword("label"),"Activate",l.keyword("on-click"),function(u){return j.call(null,u,o)}))),l.keyword("class"),"mb-4",l.keyword("content"),l.vector(l.keyword("div"),(()=>{const u=l.keyword("description").call(null,o);if(l.truth_.call(null,u)){const V=u;return l.vector(l.keyword("p"),V)}})())))),k=l.unchecked_inc.call(null,k);continue}else return!0;break}})()?l.chunk_cons.call(null,l.chunk.call(null,d),n.call(null,l.chunk_rest.call(null,s))):l.chunk_cons.call(null,l.chunk.call(null,d),null)}else{const r=l.first.call(null,s);return l.cons.call(null,l.vector(y.box,l.array_map(l.keyword("key"),l.keyword("key").call(null,r),l.keyword("title"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"flex items-center",l.keyword("style"),l.array_map(l.keyword("margin-top"),"-1px")),l.vector(f),l.vector(l.keyword("a"),l.array_map(l.keyword("class"),"underline",l.keyword("href"),h.call(null,r),l.keyword("target"),"_blank"),(()=>{const e=l.keyword("label").call(null,r);return l.truth_.call(null,e)?e:l.keyword("key").call(null,r)})()),l.truth_.call(null,l.keyword("activated").call(null,r))?l.vector(g.activated_button,l.array_map(l.keyword("on-click"),function(e){return q.call(null,e,r)})):l.vector(g.activate_button,l.array_map(l.keyword("label"),"Activate",l.keyword("on-click"),function(e){return j.call(null,e,r)}))),l.keyword("class"),"mb-4",l.keyword("content"),l.vector(l.keyword("div"),(()=>{const e=l.keyword("description").call(null,r);if(l.truth_.call(null,e)){const d=e;return l.vector(l.keyword("p"),d)}})()))),n.call(null,l.rest.call(null,s)))}}break}},null,null)}.call(null,l.sort_by.call(null,function(n){return v.lower_case.call(null,(()=>{const t=l.keyword("label").call(null,n);return l.truth_.call(null,t)?t:l.keyword("key").call(null,n)})())},l.vals.call(null,U))))},G=function(a,c){return l.update.call(null,l.assoc.call(null,a,l.keyword("rpub.plugins.admin.plugins-page/needs-restart"),!0),l.keyword("rpub.plugins.admin.plugins-page/activated-plugins"),l.fnil.call(null,l.conj,l.hash_set()),c)},Z=function(a,c){return l.update.call(null,l.assoc.call(null,a,l.keyword("rpub.plugins.admin.plugins-page/needs-restart"),!0),l.keyword("rpub.plugins.admin.plugins-page/activated-plugins"),l.disj,c)},z=function(a){return l.assoc.call(null,a,l.keyword("rpub.plugins.admin.plugins-page/restarted"),!0)},H=l.array_map(l.keyword("nodes"),l.array_map(l.keyword("rpub.plugins.admin.plugins-page/needs-restart"),l.array_map(l.keyword("calc"),l.keyword("rpub.plugins.admin.plugins-page/needs-restart")),l.keyword("rpub.plugins.admin.plugins-page/restart-server"),l.array_map(l.keyword("push"),z),l.keyword("rpub.plugins.admin.plugins-page/activated-plugins"),l.array_map(l.keyword("calc"),l.keyword("rpub.plugins.admin.plugins-page/activated-plugins")),l.keyword("rpub.plugins.admin.plugins-page/activate-plugin"),l.array_map(l.keyword("push"),G),l.keyword("rpub.plugins.admin.plugins-page/deactivate-plugin"),l.array_map(l.keyword("push"),Z)),l.keyword("edges"),l.vector(l.vector(l.keyword("rpub.plugins.admin.plugins-page/activate-plugin"),l.keyword("rpub.plugins.admin.plugins-page/needs-restart")),l.vector(l.keyword("rpub.plugins.admin.plugins-page/activate-plugin"),l.keyword("rpub.plugins.admin.plugins-page/activated-plugins")),l.vector(l.keyword("rpub.plugins.admin.plugins-page/deactivate-plugin"),l.keyword("rpub.plugins.admin.plugins-page/needs-restart")),l.vector(l.keyword("rpub.plugins.admin.plugins-page/deactivate-plugin"),l.keyword("rpub.plugins.admin.plugins-page/activated-plugins")))),D=l.array_map(l.keyword("page-id"),l.keyword("plugins-page"),l.keyword("component"),A,l.keyword("dag-config"),H);export{G as activate_plugin,D as config,H as dag_config,Z as deactivate_plugin,A as page,f as plugin_icon,h as plugin_url,z as restart_server};
