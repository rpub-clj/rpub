import*as l from"cherry-cljs/cljs.core.js";import*as b from"cherry-cljs/lib/clojure.string.js";import{use_dag as V}from"rpub.lib.dag.react";import*as w from"rpub.lib.html";import*as f from"rpub.lib.http";import*as k from"rpub.plugins.admin.impl";var h=function(t){return l.vector(l.keyword("svg"),l.array_map(l.keyword("class"),"w-8 h-8 text-gray-500 mr-4",l.keyword("aria-hidden"),"true",l.keyword("xmlns"),"http://www.w3.org/2000/svg",l.keyword("width"),"24",l.keyword("height"),"24",l.keyword("fill"),"currentColor",l.keyword("viewBox"),"0 0 24 24"),l.vector(l.keyword("path"),l.array_map(l.keyword("fill-rule"),"evenodd",l.keyword("d"),"M13 11.15V4a1 1 0 1 0-2 0v7.15L8.78 8.374a1 1 0 1 0-1.56 1.25l4 5a1 1 0 0 0 1.56 0l4-5a1 1 0 1 0-1.56-1.25L13 11.15Z",l.keyword("clip-rule"),"evenodd")),l.vector(l.keyword("path"),l.array_map(l.keyword("fill-rule"),"evenodd",l.keyword("d"),"M9.657 15.874 7.358 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-2.358l-2.3 2.874a3 3 0 0 1-4.685 0ZM17 16a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2H17Z",l.keyword("clip-rule"),"evenodd")))},x=function(t){const i=b.split.call(null,l.keyword("key").call(null,t),/\//),d=l.nth.call(null,i,0,null),L=l.last.call(null,b.split.call(null,d,/\./));return l.str.call(null,"https://github.com/rpub-clj/plugins/tree/main/plugins/",L)},I=function(t){const i=t,d=l.__destructure_map.call(null,i),L=d,U=l.get.call(null,d,l.keyword("current-plugins")),j=l.get.call(null,d,l.keyword("available-plugins")),E=V.call(null,l.vector(l.keyword("rpub.plugins.admin.plugins-page/needs-restart"),l.keyword("rpub.plugins.admin.plugins-page/activated-plugins"))),q=l.nth.call(null,E,0,null),G=l.__destructure_map.call(null,q),A=l.get.call(null,G,l.keyword("rpub.plugins.admin.plugins-page/needs-restart")),Z=l.get.call(null,G,l.keyword("rpub.plugins.admin.plugins-page/activated-plugins")),m=l.nth.call(null,E,1,null),v=l.array_map(l.keyword("format"),l.keyword("transit")),z=k.index_by.call(null,l.keyword("key"),U),Q=function(_,a){const n=l.assoc.call(null,a,l.keyword("activated"),!0),s=l.array_map(l.keyword("plugin"),l.select_keys.call(null,n,l.vector(l.keyword("key")))),p=function(e,r){if(l.truth_.call(null,e))return m.call(null,l.keyword("rpub.plugins.admin.plugins-page/activate-plugin"),l.keyword("key").call(null,n))},u=l.merge.call(null,v,l.array_map(l.keyword("body"),s,l.keyword("on-complete"),p));return f.post.call(null,"/admin/api/activate-plugin",u)},S=function(_,a){const n=l.array_map(l.keyword("plugin"),l.select_keys.call(null,a,l.vector(l.keyword("key")))),s=function(u,e){if(l.truth_.call(null,u))return m.call(null,l.keyword("rpub.plugins.admin.plugins-page/deactivate-plugin"),l.keyword("key").call(null,a))},p=l.merge.call(null,v,l.array_map(l.keyword("body"),n,l.keyword("on-complete"),s));return f.post.call(null,"/admin/api/deactivate-plugin",p)},H=function(_){const a=function(s,p){return null},n=l.merge.call(null,v,l.array_map(l.keyword("on-complete"),a));return m.call(null,l.keyword("rpub.plugins.admin.plugins-page/restart-server")),f.post.call(null,"/api/restart-server",n)},P=k.index_by.call(null,l.keyword("key"),j),B=l.into.call(null,l.array_map(),l.map.call(null,function(_){return l.vector(_,l.array_map(l.keyword("activated"),!0))},Z)),K=l.merge_with.call(null,l.merge,z,P,B);return l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"p-4"),l.vector(k.box,l.array_map(l.keyword("title"),"Plugins",l.keyword("class"),"mb-4",l.keyword("content"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"flex"),l.vector(l.keyword("p"),l.array_map(l.keyword("class"),"italic"),"Note: The server must be restarted after activating a plugin for the first time."),l.truth_.call(null,A)?l.vector(l.keyword("button"),l.array_map(l.keyword("class"),"font-app-sans inline-flex items-center px-5 py-2.5 text-sm font-medium text-center text-white bg-blue-700 rounded-lg focus:ring-4 focus:ring-primary-200 hover:bg-primary-800 shadow-sm ml-auto w-44",l.keyword("on-click"),H),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"inline-flex items-center mx-auto"),"Restart")):null))),function a(n){return new l.LazySeq(null,function(){let s=n;for(;;){const p=l.seq.call(null,s);if(l.truth_.call(null,p)){const u=p;if(l.truth_.call(null,l.chunked_seq_QMARK_.call(null,u))){const e=l.chunk_first.call(null,u),r=l.count.call(null,e),y=l.chunk_buffer.call(null,r);return(()=>{let g=0;for(;;){if(g<r){const c=l._nth.call(null,e,g);l.chunk_append.call(null,y,l.vector(k.box,l.array_map(l.keyword("key"),l.keyword("key").call(null,c),l.keyword("title"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"flex items-center",l.keyword("style"),l.array_map(l.keyword("margin-top"),"-1px")),l.vector(h),l.vector(l.keyword("a"),l.array_map(l.keyword("class"),"underline",l.keyword("href"),x.call(null,c),l.keyword("target"),"_blank"),(()=>{const o=l.keyword("label").call(null,c);return l.truth_.call(null,o)?o:l.keyword("key").call(null,c)})()),l.truth_.call(null,l.keyword("activated").call(null,c))?l.vector(w.activated_button,l.array_map(l.keyword("on-click"),function(o){return S.call(null,o,c)})):l.vector(w.activate_button,l.array_map(l.keyword("label"),"Activate Plugin",l.keyword("on-click"),function(o){return Q.call(null,o,c)}))),l.keyword("class"),"mb-4",l.keyword("content"),l.vector(l.keyword("div"),(()=>{const o=l.keyword("description").call(null,c);if(l.truth_.call(null,o)){const R=o;return l.vector(l.keyword("p"),R)}})())))),g=l.unchecked_inc.call(null,g);continue}else return!0;break}})()?l.chunk_cons.call(null,l.chunk.call(null,y),a.call(null,l.chunk_rest.call(null,u))):l.chunk_cons.call(null,l.chunk.call(null,y),null)}else{const e=l.first.call(null,u);return l.cons.call(null,l.vector(k.box,l.array_map(l.keyword("key"),l.keyword("key").call(null,e),l.keyword("title"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"flex items-center",l.keyword("style"),l.array_map(l.keyword("margin-top"),"-1px")),l.vector(h),l.vector(l.keyword("a"),l.array_map(l.keyword("class"),"underline",l.keyword("href"),x.call(null,e),l.keyword("target"),"_blank"),(()=>{const r=l.keyword("label").call(null,e);return l.truth_.call(null,r)?r:l.keyword("key").call(null,e)})()),l.truth_.call(null,l.keyword("activated").call(null,e))?l.vector(w.activated_button,l.array_map(l.keyword("on-click"),function(r){return S.call(null,r,e)})):l.vector(w.activate_button,l.array_map(l.keyword("label"),"Activate Plugin",l.keyword("on-click"),function(r){return Q.call(null,r,e)}))),l.keyword("class"),"mb-4",l.keyword("content"),l.vector(l.keyword("div"),(()=>{const r=l.keyword("description").call(null,e);if(l.truth_.call(null,r)){const y=r;return l.vector(l.keyword("p"),y)}})()))),a.call(null,l.rest.call(null,u)))}}break}},null,null)}.call(null,l.sort_by.call(null,function(a){return b.lower_case.call(null,(()=>{const n=l.keyword("label").call(null,a);return l.truth_.call(null,n)?n:l.keyword("key").call(null,a)})())},l.vals.call(null,K))))},M=function(t,i){return l.update.call(null,l.assoc.call(null,t,l.keyword("rpub.plugins.admin.plugins-page/needs-restart"),!0),l.keyword("rpub.plugins.admin.plugins-page/activated-plugins"),l.fnil.call(null,l.conj,l.hash_set()),i)},N=function(t,i){return l.update.call(null,l.assoc.call(null,t,l.keyword("rpub.plugins.admin.plugins-page/needs-restart"),!0),l.keyword("rpub.plugins.admin.plugins-page/activated-plugins"),l.disj,i)},O=function(t){return l.assoc.call(null,t,l.keyword("rpub.plugins.admin.plugins-page/restarted"),!0)},T=l.array_map(l.keyword("nodes"),l.array_map(l.keyword("rpub.plugins.admin.plugins-page/needs-restart"),l.array_map(l.keyword("calc"),l.keyword("rpub.plugins.admin.plugins-page/needs-restart")),l.keyword("rpub.plugins.admin.plugins-page/restart-server"),l.array_map(l.keyword("push"),O),l.keyword("rpub.plugins.admin.plugins-page/activated-plugins"),l.array_map(l.keyword("calc"),l.keyword("rpub.plugins.admin.plugins-page/activated-plugins")),l.keyword("rpub.plugins.admin.plugins-page/activate-plugin"),l.array_map(l.keyword("push"),M),l.keyword("rpub.plugins.admin.plugins-page/deactivate-plugin"),l.array_map(l.keyword("push"),N)),l.keyword("edges"),l.vector(l.vector(l.keyword("rpub.plugins.admin.plugins-page/activate-plugin"),l.keyword("rpub.plugins.admin.plugins-page/needs-restart")),l.vector(l.keyword("rpub.plugins.admin.plugins-page/activate-plugin"),l.keyword("rpub.plugins.admin.plugins-page/activated-plugins")),l.vector(l.keyword("rpub.plugins.admin.plugins-page/deactivate-plugin"),l.keyword("rpub.plugins.admin.plugins-page/needs-restart")),l.vector(l.keyword("rpub.plugins.admin.plugins-page/deactivate-plugin"),l.keyword("rpub.plugins.admin.plugins-page/activated-plugins")))),C=l.array_map(l.keyword("page-id"),l.keyword("plugins-page"),l.keyword("component"),I,l.keyword("dag-config"),T);export{M as activate_plugin,C as config,T as dag_config,N as deactivate_plugin,I as page,h as plugin_icon,x as plugin_url,O as restart_server};
