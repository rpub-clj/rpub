import*as l from"cherry-cljs/cljs.core.js";import*as f from"cherry-cljs/lib/clojure.string.js";import*as v from"rpub.lib.html";import*as b from"rpub.lib.http";import{subscribe as M,dispatch as h}from"rpub.lib.substrate";import*as y from"rpub.plugins.admin.helpers";var x=function(e){return l.vector(l.keyword("svg"),l.array_map(l.keyword("class"),"w-8 h-8 text-gray-500 mr-4",l.keyword("aria-hidden"),"true",l.keyword("xmlns"),"http://www.w3.org/2000/svg",l.keyword("width"),"24",l.keyword("height"),"24",l.keyword("fill"),"currentColor",l.keyword("viewBox"),"0 0 24 24"),l.vector(l.keyword("path"),l.array_map(l.keyword("fill-rule"),"evenodd",l.keyword("d"),"M13 11.15V4a1 1 0 1 0-2 0v7.15L8.78 8.374a1 1 0 1 0-1.56 1.25l4 5a1 1 0 0 0 1.56 0l4-5a1 1 0 1 0-1.56-1.25L13 11.15Z",l.keyword("clip-rule"),"evenodd")),l.vector(l.keyword("path"),l.array_map(l.keyword("fill-rule"),"evenodd",l.keyword("d"),"M9.657 15.874 7.358 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-2.358l-2.3 2.874a3 3 0 0 1-4.685 0ZM17 16a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2H17Z",l.keyword("clip-rule"),"evenodd")))},q=function(e){const u=f.split.call(null,l.keyword("key").call(null,e),/\//),a=l.nth.call(null,u,0,null),k=l.last.call(null,f.split.call(null,a,/\./));return l.str.call(null,"https://github.com/rpub-clj/plugins/tree/main/plugins/",k)},j=function(e){const u=e,a=l.__destructure_map.call(null,u),k=a,s=l.get.call(null,a,l.keyword("current-plugins")),Q=l.get.call(null,a,l.keyword("available-plugins")),S=M.call(null,l.vector(l.keyword("rpub.plugins.admin.plugins.page/needs-restart"))),B=M.call(null,l.vector(l.keyword("rpub.plugins.admin.plugins.page/activated-plugins"))),I=y.index_by.call(null,l.keyword("key"),s),G=function(d,r){const o=l.assoc.call(null,r,l.keyword("activated"),!0),w=l.array_map(l.keyword("plugin"),l.select_keys.call(null,o,l.vector(l.keyword("key"))));return b.post.call(null,"/admin/api/activate-plugin",l.array_map(l.keyword("body"),w)).then(function(m){return h.call(null,l.vector(l.keyword("rpub.plugins.admin.plugins.page/activate-plugin"),l.keyword("key").call(null,o)))})},L=function(d,r){const o=l.array_map(l.keyword("plugin"),l.select_keys.call(null,r,l.vector(l.keyword("key"))));return b.post.call(null,"/admin/api/deactivate-plugin",l.array_map(l.keyword("body"),o)).then(function(w){return h.call(null,l.vector(l.keyword("rpub.plugins.admin.plugins.page/deactivate-plugin"),l.keyword("key").call(null,r)))})},K=function(d){return h.call(null,l.vector(l.keyword("rpub.plugins.admin.plugins.page/restart-server"))),b.post.call(null,"/api/restart-server",l.array_map())},N=y.index_by.call(null,l.keyword("key"),Q),O=l.into.call(null,l.array_map(),l.map.call(null,function(d){return l.vector(d,l.array_map(l.keyword("activated"),!0))},B)),R=l.merge_with.call(null,l.merge,I,N,O);return l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"p-4"),l.vector(y.box,l.array_map(l.keyword("title"),"Plugins",l.keyword("class"),"mb-4",l.keyword("content"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"flex"),l.vector(l.keyword("p"),l.array_map(l.keyword("class"),"italic"),"Note: The server must be restarted after activating a plugin for the first time."),l.truth_.call(null,S)?l.vector(l.keyword("button"),l.array_map(l.keyword("class"),"font-app-sans inline-flex items-center px-5 py-2.5 text-sm font-medium text-center text-white bg-blue-700 rounded-lg focus:ring-4 focus:ring-primary-200 hover:bg-primary-800 shadow-sm ml-auto w-44",l.keyword("on-click"),K),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"inline-flex items-center mx-auto"),"Restart")):null))),function r(o){return new l.LazySeq(null,function(){let w=o;for(;;){const m=l.seq.call(null,w);if(l.truth_.call(null,m)){const p=m;if(l.truth_.call(null,l.chunked_seq_QMARK_.call(null,p))){const t=l.chunk_first.call(null,p),n=l.count.call(null,t),_=l.chunk_buffer.call(null,n);return(()=>{let g=0;for(;;){if(g<n){const i=l._nth.call(null,t,g);l.chunk_append.call(null,_,l.vector(y.box,l.array_map(l.keyword("key"),l.keyword("key").call(null,i),l.keyword("title"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"flex items-center",l.keyword("style"),l.array_map(l.keyword("margin-top"),"-1px")),l.vector(x),l.vector(l.keyword("a"),l.array_map(l.keyword("class"),"underline",l.keyword("href"),q.call(null,i),l.keyword("target"),"_blank"),(()=>{const c=l.keyword("label").call(null,i);return l.truth_.call(null,c)?c:l.keyword("key").call(null,i)})()),l.truth_.call(null,l.keyword("activated").call(null,i))?l.vector(v.activated_button,l.array_map(l.keyword("on-click"),function(c){return L.call(null,c,i)})):l.vector(v.activate_button,l.array_map(l.keyword("label"),"Activate",l.keyword("on-click"),function(c){return G.call(null,c,i)}))),l.keyword("class"),"mb-4",l.keyword("content"),l.vector(l.keyword("div"),(()=>{const c=l.keyword("description").call(null,i);if(l.truth_.call(null,c)){const T=c;return l.vector(l.keyword("p"),T)}})())))),g=l.unchecked_inc.call(null,g);continue}else return!0;break}})()?l.chunk_cons.call(null,l.chunk.call(null,_),r.call(null,l.chunk_rest.call(null,p))):l.chunk_cons.call(null,l.chunk.call(null,_),null)}else{const t=l.first.call(null,p);return l.cons.call(null,l.vector(y.box,l.array_map(l.keyword("key"),l.keyword("key").call(null,t),l.keyword("title"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"flex items-center",l.keyword("style"),l.array_map(l.keyword("margin-top"),"-1px")),l.vector(x),l.vector(l.keyword("a"),l.array_map(l.keyword("class"),"underline",l.keyword("href"),q.call(null,t),l.keyword("target"),"_blank"),(()=>{const n=l.keyword("label").call(null,t);return l.truth_.call(null,n)?n:l.keyword("key").call(null,t)})()),l.truth_.call(null,l.keyword("activated").call(null,t))?l.vector(v.activated_button,l.array_map(l.keyword("on-click"),function(n){return L.call(null,n,t)})):l.vector(v.activate_button,l.array_map(l.keyword("label"),"Activate",l.keyword("on-click"),function(n){return G.call(null,n,t)}))),l.keyword("class"),"mb-4",l.keyword("content"),l.vector(l.keyword("div"),(()=>{const n=l.keyword("description").call(null,t);if(l.truth_.call(null,n)){const _=n;return l.vector(l.keyword("p"),_)}})()))),r.call(null,l.rest.call(null,p)))}}break}},null,null)}.call(null,l.sort_by.call(null,function(r){return f.lower_case.call(null,(()=>{const o=l.keyword("label").call(null,r);return l.truth_.call(null,o)?o:l.keyword("key").call(null,r)})())},(()=>{const r=l.vals.call(null,R);return l.prn.call(null,r),r})())))},A=function(e,u){const a=u,k=l.nth.call(null,a,0,null),s=l.nth.call(null,a,1,null);return l.update.call(null,l.assoc.call(null,e,l.keyword("rpub.plugins.admin.plugins.page/needs-restart"),!0),l.keyword("rpub.plugins.admin.plugins.page/activated-plugins"),l.fnil.call(null,l.conj,l.hash_set()),s)},Z=function(e,u){const a=u,k=l.nth.call(null,a,0,null),s=l.nth.call(null,a,1,null);return l.update.call(null,l.assoc.call(null,e,l.keyword("rpub.plugins.admin.plugins.page/needs-restart"),!0),l.keyword("rpub.plugins.admin.plugins.page/activated-plugins"),l.disj,s)},z=function(e,u){return l.assoc.call(null,e,l.keyword("rpub.plugins.admin.plugins.page/restarted"),!0)},H=l.array_map(l.keyword("queries"),l.array_map(l.keyword("rpub.plugins.admin.plugins.page/needs-restart"),function(e,u){return l.keyword("rpub.plugins.admin.plugins.page/needs-restart").call(null,e)},l.keyword("rpub.plugins.admin.plugins.page/activated-plugins"),function(e,u){return l.keyword("rpub.plugins.admin.plugins.page/activated-plugins").call(null,e)}),l.keyword("transactions"),l.array_map(l.keyword("rpub.plugins.admin.plugins.page/activate-plugin"),A,l.keyword("rpub.plugins.admin.plugins.page/deactivate-plugin"),Z,l.keyword("rpub.plugins.admin.plugins.page/restart-server"),z)),U=l.array_map(l.keyword("page-id"),l.keyword("plugins-page"),l.keyword("model"),H,l.keyword("component"),j);export{A as activate_plugin,U as config,Z as deactivate_plugin,H as model,j as page,x as plugin_icon,q as plugin_url,z as restart_server};
