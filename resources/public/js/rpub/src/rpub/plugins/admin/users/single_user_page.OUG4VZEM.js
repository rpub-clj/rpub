import*as l from"cherry-cljs/cljs.core.js";import{useEffect as G}from"react";import{use_dag as U}from"rpub.lib.dag.react";import*as y from"rpub.lib.forms";import*as b from"rpub.lib.html";import*as D from"rpub.lib.http";import*as L from"rpub.plugins.admin.helpers";var h=l.array_map(l.keyword("username"),l.array_map(l.keyword("valid"),function(n){const r=l.string_QMARK_.call(null,n);if(l.truth_.call(null,r)){const e=l.seq.call(null,n);return l.truth_.call(null,e)?l.count.call(null,n)>=3:e}else return r},l.keyword("message"),"Must be at least 3 characters"),l.keyword("password"),l.array_map(l.keyword("valid"),function(n){const r=l.string_QMARK_.call(null,n);if(l.truth_.call(null,r)){const e=l.seq.call(null,n);return l.truth_.call(null,e)?l.count.call(null,n)>=6:e}else return r},l.keyword("message"),"Must be at least 6 characters"),l.keyword("roles"),l.array_map(l.keyword("valid"),function(n){const r=l.string_QMARK_.call(null,n);return l.truth_.call(null,r)?l.seq.call(null,n):r},l.keyword("message"),"Required")),m=function(n){const r=n,e=l.__destructure_map.call(null,r),a=l.get.call(null,e,l.keyword("value")),t=l.get.call(null,e,l.keyword("valid")),d=l.get.call(null,e,l.keyword("on-change")),c=l.get.call(null,e,l.keyword("type")),k=l.get.call(null,e,l.keyword("name"));return l.vector(b.input2,l.array_map(l.keyword("type"),c,l.keyword("name"),k,l.keyword("value"),a,l.keyword("class"),l.truth_.call(null,l.false_QMARK_.call(null,t))?"border-red-500":"",l.keyword("on-change"),d))},v=function(n){const r=l.array_map(l.keyword("id"),l.keyword("rpub.plugins.admin.users.single-user-page/form"),l.keyword("schema"),h),e=U.call(null,l.vector(l.vector(l.keyword("rpub.lib.forms/submitting"),r),l.vector(l.keyword("rpub.lib.forms/ready-to-submit"),r))),a=l.nth.call(null,e,0,null),t=l.nth.call(null,e,1,null),d=l.get.call(null,a,l.vector(l.keyword("rpub.lib.forms/submitting"),r)),c=l.get.call(null,a,l.vector(l.keyword("rpub.lib.forms/ready-to-submit"),r)),k=G.call(null,function(){return t.call(null,l.keyword("rpub.lib.forms/init"),r)},[]),A=function(w){if(w.preventDefault(),l.truth_.call(null,c))return t.call(null,l.keyword("rpub.plugins.admin.users.single-user-page/submit-start")),D.post.call(null,"/admin/api/create-user",l.array_map(l.keyword("body"),l.array_map())).then(function(s){return window.location.reload()}).catch(function(s){return t.call(null,l.keyword("rpub.plugins.admin.users.single-user-page/submit-error"))})},K=l.vector(l.array_map(l.keyword("key"),l.keyword("username"),l.keyword("label"),"Username",l.keyword("type"),l.keyword("text")),l.array_map(l.keyword("key"),l.keyword("password"),l.keyword("label"),"Password",l.keyword("type"),l.keyword("password")));return l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"p-4"),l.vector(L.box,l.array_map(l.keyword("title"),"New User",l.keyword("content"),l.vector(l.keyword("section"),l.array_map(l.keyword("class"),"bg-white"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"max-w-2xl"),l.vector(l.keyword("form"),l.array_map(l.keyword("on-submit"),A),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"grid gap-4 sm:grid-cols-2 sm:gap-6"),function s(Q){return new l.LazySeq(null,function(){let z=Q;for(;;){const p=l.seq.call(null,z);if(l.truth_.call(null,p)){const o=p;if(l.truth_.call(null,l.chunked_seq_QMARK_.call(null,o))){const u=l.chunk_first.call(null,o),f=l.count.call(null,u),i=l.chunk_buffer.call(null,f);return(()=>{let _=0;for(;;){if(_<f){const g=l._nth.call(null,u,_);l.chunk_append.call(null,i,l.vector(y.field,l.array_map(l.keyword("form"),r,l.keyword("key"),l.keyword("key").call(null,g),l.keyword("field-config"),g,l.keyword("input-component"),m))),_=l.unchecked_inc.call(null,_);continue}else return!0;break}})()?l.chunk_cons.call(null,l.chunk.call(null,i),s.call(null,l.chunk_rest.call(null,o))):l.chunk_cons.call(null,l.chunk.call(null,i),null)}else{const u=l.first.call(null,o);return l.cons.call(null,l.vector(y.field,l.array_map(l.keyword("form"),r,l.keyword("key"),l.keyword("key").call(null,u),l.keyword("field-config"),u,l.keyword("input-component"),m)),s.call(null,l.rest.call(null,o)))}}break}},null,null)}.call(null,K),l.vector(b.submit_button,l.array_map(l.keyword("ready-label"),"Create",l.keyword("submit-label"),"Creating...",l.keyword("submitting"),d,l.keyword("disabled"),l.not.call(null,c))))))))))},q=function(n){return null},M=function(n){const r=n,e=l.__destructure_map.call(null,r),a=e,t=l.get.call(null,e,l.keyword("editing"));return l.truth_.call(null,t)?l.vector(q,a):l.vector(v,a)},x=y.dag_config,R=l.array_map(l.keyword("page-id"),l.keyword("single-user-page"),l.keyword("component"),M,l.keyword("dag-config"),x);export{R as config,x as dag_config,q as edit_user_page,h as form_schema,m as html_input,v as new_user_page,M as single_user_page};
