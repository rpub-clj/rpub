import*as l from"cherry-cljs/cljs.core.js";import{useEffect as U}from"react";import*as g from"rpub.lib.forms";import*as q from"rpub.lib.html";import*as M from"rpub.lib.http";import{subscribe as x,dispatch as _}from"rpub.lib.substrate";import*as z from"rpub.plugins.admin.helpers";var A=l.array_map(l.keyword("username"),l.array_map(l.keyword("valid"),function(e){const a=l.string_QMARK_.call(null,e);if(l.truth_.call(null,a)){const r=l.seq.call(null,e);return l.truth_.call(null,r)?l.count.call(null,e)>=3:r}else return a},l.keyword("message"),"Must be at least 3 characters"),l.keyword("password"),l.array_map(l.keyword("valid"),function(e){const a=l.string_QMARK_.call(null,e);if(l.truth_.call(null,a)){const r=l.seq.call(null,e);return l.truth_.call(null,r)?l.count.call(null,e)>=6:r}else return a},l.keyword("message"),"Must be at least 6 characters"),l.keyword("roles"),l.array_map(l.keyword("valid"),function(e){const a=l.string_QMARK_.call(null,e);return l.truth_.call(null,a)?l.seq.call(null,e):a},l.keyword("message"),"Required")),f=function(e){const a=e,r=l.__destructure_map.call(null,a),t=l.get.call(null,r,l.keyword("value")),n=l.get.call(null,r,l.keyword("touched")),y=l.get.call(null,r,l.keyword("valid")),m=l.get.call(null,r,l.keyword("on-change")),b=l.get.call(null,r,l.keyword("on-blur")),w=l.get.call(null,r,l.keyword("type")),k=l.get.call(null,r,l.keyword("name"));return l.vector(q.input2,l.array_map(l.keyword("type"),w,l.keyword("name"),k,l.keyword("value"),t,l.keyword("class"),l.truth_.call(null,(()=>{const o=y;return l.truth_.call(null,o)?o:l.not.call(null,n)})())?"":"border-red-500",l.keyword("on-blur"),b,l.keyword("on-change"),m))},K=function(e){const a=e,r=l.__destructure_map.call(null,a),t=l.get.call(null,r,l.keyword("user")),n=l.array_map(l.keyword("id"),l.keyword("rpub.plugins.admin.users.single-user-page/form"),l.keyword("schema"),A,l.keyword("initial-values"),l.truth_.call(null,t)?l.merge.call(null,l.select_keys.call(null,t,l.vector(l.keyword("username"))),l.array_map(l.keyword("password"),"*************")):l.array_map(l.keyword("username"),"",l.keyword("password"),"")),y=x.call(null,l.vector(l.keyword("rpub.lib.forms/submitting"),n)),m=x.call(null,l.vector(l.keyword("rpub.lib.forms/field-values"),n)),b=U.call(null,function(){return _.call(null,l.vector(l.keyword("rpub.lib.forms/init"),n))},[]),w=function(o){const u=l.update_vals.call(null,m,l.keyword("value"));return _.call(null,l.vector(l.keyword("rpub.lib.forms/submit-start"))),l.truth_.call(null,t)?M.post.call(null,"/admin/api/edit-user",l.array_map(l.keyword("body"),u)).then(function(c){return window.reload()}).catch(function(c){return _.call(null,l.vector(l.keyword("rpub.lib.forms/submit-error")))}):M.post.call(null,"/admin/api/create-user",l.array_map(l.keyword("body"),u)).then(function(c){return window.location="/admin/users"}).catch(function(c){return _.call(null,l.vector(l.keyword("rpub.lib.forms/submit-error")))})},k=l.vector(l.array_map(l.keyword("key"),l.keyword("username"),l.keyword("label"),"Username",l.keyword("type"),l.keyword("text")),l.array_map(l.keyword("key"),l.keyword("password"),l.keyword("label"),"Password",l.keyword("type"),l.keyword("password")));return l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"p-4"),l.vector(z.box,l.array_map(l.keyword("title"),l.truth_.call(null,t)?"Edit User":"New User",l.keyword("content"),l.vector(l.keyword("section"),l.array_map(l.keyword("class"),"bg-white"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"max-w-2xl"),l.vector(l.keyword("form"),l.array_map(l.keyword("on-submit"),function(o){return o.preventDefault(),_.call(null,l.vector(l.keyword("rpub.lib.forms/submit-form"),n,w))}),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"grid gap-4 sm:grid-cols-2 sm:gap-6"),function u(c){return new l.LazySeq(null,function(){let Q=c;for(;;){const h=l.seq.call(null,Q);if(l.truth_.call(null,h)){const s=h;if(l.truth_.call(null,l.chunked_seq_QMARK_.call(null,s))){const d=l.chunk_first.call(null,s),v=l.count.call(null,d),p=l.chunk_buffer.call(null,v);return(()=>{let i=0;for(;;){if(i<v){const S=l._nth.call(null,d,i);l.chunk_append.call(null,p,l.vector(g.field,l.array_map(l.keyword("form"),n,l.keyword("field-config"),S,l.keyword("input-component"),f))),i=l.unchecked_inc.call(null,i);continue}else return!0;break}})()?l.chunk_cons.call(null,l.chunk.call(null,p),u.call(null,l.chunk_rest.call(null,s))):l.chunk_cons.call(null,l.chunk.call(null,p),null)}else{const d=l.first.call(null,s);return l.cons.call(null,l.vector(g.field,l.array_map(l.keyword("form"),n,l.keyword("field-config"),d,l.keyword("input-component"),f)),u.call(null,l.rest.call(null,s)))}}break}},null,null)}.call(null,k),l.vector(q.submit_button,l.array_map(l.keyword("ready-label"),l.truth_.call(null,t)?"Save":"Create",l.keyword("submit-label"),l.truth_.call(null,t)?"Saving...":"Creating...",l.keyword("submitting"),y)))))))))},G=l.array_map(l.keyword("page-id"),l.keyword("single-user-page"),l.keyword("component"),K);export{G as config,A as form_schema,f as html_input,K as page};
