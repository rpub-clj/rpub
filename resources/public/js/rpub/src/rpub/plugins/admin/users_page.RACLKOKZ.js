import*as l from"cherry-cljs/cljs.core.js";import*as K from"cherry-cljs/lib/clojure.string.js";import*as M from"rads.inflections";import*as b from"rpub.lib.html";import*as f from"rpub.lib.http";import*as g from"rpub.plugins.admin.impl";import*as w from"rpub.plugins.admin.roles";var N=l.vector(l.array_map(l.keyword("name"),"Username",l.keyword("value"),function(o){const a=o,e=l.__destructure_map.call(null,a),r=l.get.call(null,e,l.keyword("username"));return l.vector(l.keyword("a"),l.array_map(l.keyword("class"),"font-semibold"),r)}),l.array_map(l.keyword("name"),"Roles",l.keyword("value"),function(o){const a=o,e=l.__destructure_map.call(null,a),r=l.get.call(null,e,l.keyword("roles"));return K.join.call(null,", ",l.map.call(null,l.keyword("label"),r))})),A=function(o){const a=o,e=l.__destructure_map.call(null,a),r=l.get.call(null,e,l.keyword("checked")),c=l.get.call(null,e,l.keyword("disabled")),n=l.get.call(null,e,l.keyword("on-change"));return l.vector(l.keyword("input"),l.array_map(l.keyword("type"),"checkbox",l.keyword("checked"),r,l.keyword("disabled"),c,l.keyword("on-change"),n,l.keyword("class"),"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded-sm focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"))},q=l.array_map(l.keyword("name"),"Permission",l.keyword("value"),function(o){const a=o,e=l.__destructure_map.call(null,a),r=l.get.call(null,e,l.keyword("permission-key"));return M.titleize.call(null,l.name.call(null,r))}),R=function(o){const a=o,e=l.__destructure_map.call(null,a),r=l.get.call(null,e,l.keyword("current-user")),c=l.get.call(null,e,l.keyword("role"));return l.array_map(l.keyword("name"),l.keyword("label").call(null,c),l.keyword("value"),function(n){const y=l.contains_QMARK_.call(null,l.set.call(null,l.keyword("roles").call(null,n)),l.keyword("label").call(null,c)),k=(()=>{const s=l._EQ_.call(null,l.keyword("label").call(null,c),"Admin");return l.truth_.call(null,s)?s:l.not.call(null,w.allowed_QMARK_.call(null,r,l.keyword("permission").call(null,n)))})(),t=function(s){const i=s.target.checked;return f.post.call(null,"/admin/api/update-role",l.array_map(l.keyword("permission"),l.keyword("permission").call(null,n),l.keyword("allowed"),i))};return l.vector(A,l.array_map(l.keyword("checked"),y,l.keyword("disabled"),k,l.keyword("on-change"),t))})},x=function(o){const a=o,e=l.__destructure_map.call(null,a),r=l.get.call(null,e,l.keyword("current-user")),c=l.get.call(null,e,l.keyword("roles"));return l.concat.call(null,l.vector(q),l.map.call(null,function(n){return R.call(null,l.array_map(l.keyword("role"),n,l.keyword("current-user"),r))},c))},Q=function(o){const a=o,e=l.__destructure_map.call(null,a),r=l.get.call(null,e,l.keyword("current-user")),c=l.get.call(null,e,l.keyword("users")),n=l.get.call(null,e,l.keyword("roles")),y=l.get.call(null,e,l.keyword("permissions"));return l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"p-4"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"mb-4"),l.vector(g.table,l.array_map(l.keyword("title"),"Users",l.keyword("header-buttons"),l.truth_.call(null,w.allowed_QMARK_.call(null,r,l.array_map(l.keyword("resource"),l.keyword("users"),l.keyword("action"),l.keyword("create"))))?l.vector(l.keyword("a"),l.array_map(l.keyword("href"),"/admin/users/new"),l.vector(b.action_button,"New User")):null,l.keyword("columns"),N,l.keyword("rows"),c))),l.vector(l.keyword("div"),l.vector(g.table,l.array_map(l.keyword("title"),"Roles & Permissions",l.keyword("description"),l.vector(l.keyword("div"),function t(s){return new l.LazySeq(null,function(){let i=s;for(;;){const p=l.seq.call(null,i);if(l.truth_.call(null,p)){const u=p;if(l.truth_.call(null,l.chunked_seq_QMARK_.call(null,u))){const d=l.chunk_first.call(null,u),v=l.count.call(null,d),m=l.chunk_buffer.call(null,v);return(()=>{let _=0;for(;;){if(_<v){const h=l._nth.call(null,d,_);l.chunk_append.call(null,m,l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"mb-4"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"inline-block font-semibold text-lg",l.keyword("style"),"min-width: 150px"),l.keyword("label").call(null,h)),l.vector(l.keyword("select"),l.array_map(l.keyword("class"),"inline-block",l.keyword("value"),l.truth_.call(null,l._EQ_.call(null,l.keyword("permissions").call(null,h),l.keyword("all")))?"all":"manual",l.keyword("disabled"),!0),l.vector(l.keyword("option"),l.array_map(l.keyword("value"),"all"),"Access to all permissions"),l.vector(l.keyword("option"),l.array_map(l.keyword("value"),"manual"),"Access to manually selected permissions")))),_=l.unchecked_inc.call(null,_);continue}else return!0;break}})()?l.chunk_cons.call(null,l.chunk.call(null,m),t.call(null,l.chunk_rest.call(null,u))):l.chunk_cons.call(null,l.chunk.call(null,m),null)}else{const d=l.first.call(null,u);return l.cons.call(null,l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"mb-4"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"inline-block font-semibold text-lg",l.keyword("style"),"min-width: 150px"),l.keyword("label").call(null,d)),l.vector(l.keyword("select"),l.array_map(l.keyword("class"),"inline-block",l.keyword("value"),l.truth_.call(null,l._EQ_.call(null,l.keyword("permissions").call(null,d),l.keyword("all")))?"all":"manual",l.keyword("disabled"),!0),l.vector(l.keyword("option"),l.array_map(l.keyword("value"),"all"),"Access to all permissions"),l.vector(l.keyword("option"),l.array_map(l.keyword("value"),"manual"),"Access to manually selected permissions"))),t.call(null,l.rest.call(null,u)))}}break}},null,null)}.call(null,n)),l.keyword("header-buttons"),l.truth_.call(null,w.allowed_QMARK_.call(null,r,l.array_map(l.keyword("resource"),l.keyword("roles"),l.keyword("action"),l.keyword("create"))))?l.vector(b.action_button,l.array_map(l.keyword("on-click"),function(k){const t=prompt("New Role Name:");return f.post.call(null,"/admin/api/create-role",l.array_map(l.keyword("body"),l.array_map(l.keyword("role-name"),t)))}),"New Role"):null,l.keyword("columns"),x.call(null,l.array_map(l.keyword("current-user"),r,l.keyword("roles"),n)),l.keyword("rows"),y))))},z=l.array_map(l.keyword("page-id"),l.keyword("users-page"),l.keyword("component"),Q);export{A as checkbox,z as config,Q as page,x as permissions_columns,R as role_column};
