import*as e from"cherry-cljs/cljs.core.js";import{useEffect as A}from"react";import{use_dag as M,use_dag_values as D}from"rpub.lib.dag.react";import*as i from"rpub.lib.forms";import*as y from"rpub.lib.html";import*as s from"rpub.lib.http";import*as k from"rpub.plugins.admin.helpers";var _=e.array_map(e.keyword("label"),e.array_map(e.keyword("valid"),function(t){const l=e.string_QMARK_.call(null,t);return e.truth_.call(null,l)?e.seq.call(null,t):l},e.keyword("message"),"Required"),e.keyword("html-template"),e.array_map(e.keyword("valid"),function(t){const l=e.string_QMARK_.call(null,t);return e.truth_.call(null,l)?e.seq.call(null,t):l},e.keyword("message"),"Required")),p=function(t){const l=t,a=e.__destructure_map.call(null,l),n=e.get.call(null,a,e.keyword("value")),r=e.get.call(null,a,e.keyword("valid")),o=e.get.call(null,a,e.keyword("on-change"));return e.vector(e.keyword("textarea"),e.array_map(e.keyword("class"),e.str.call(null,"w-full min-h-96 font-app-mono text-sm rounded-[6px] ",e.truth_.call(null,r)?"border-gray-300 focus:ring-primary-600 focus:border-blue-600":"bg-red-50 border-red-500 focus:ring-red-500"),e.keyword("value"),n,e.keyword("on-change"),o))},v=function(t,l,a,n){t.preventDefault();const r=n.call(null),o=e.keyword("label").call(null,e.get.call(null,r,e.vector(e.keyword("rpub.lib.forms/field-values"),e.vector(l,e.vector(e.keyword("label")))))),u=e.keyword("html-template").call(null,e.get.call(null,r,e.vector(e.keyword("rpub.lib.forms/field-values"),e.vector(l,e.vector(e.keyword("html-template")))))),d=e.array_map(e.keyword("theme"),e.dissoc.call(null,e.assoc.call(null,e.assoc.call(null,a,e.keyword("label"),e.keyword("value").call(null,o)),e.keyword("value"),e.array_map(e.keyword("html-template"),(()=>{const c=e.keyword("value").call(null,u);return e.truth_.call(null,c)?c:e.get_in.call(null,a,e.vector(e.keyword("value"),e.keyword("html-template")))})())),e.keyword("html-template")));return e.truth_.call(null,e.keyword("new").call(null,a))?s.post.call(null,"/admin/api/create-theme",e.array_map(e.keyword("body"),d)).then(function(c){return window.location="/admin/themes"}):s.post.call(null,"/admin/api/update-theme",e.array_map(e.keyword("body"),d)).then(function(c){return window.location.reload()})},b=function(t,l){const a=e.str.call(null,'Are you sure want to delete the "',e.keyword("label").call(null,l),'" theme?');if(e.truth_.call(null,confirm(a))){const n=e.select_keys.call(null,l,e.vector(e.keyword("id")));return s.post.call(null,"/admin/api/delete-theme",e.array_map(e.keyword("body"),n)).then(function(r){return window.location="/admin/themes"})}},f=function(t){const l=t,a=e.__destructure_map.call(null,l),n=a,r=e.get.call(null,a,e.keyword("theme")),o=e.array_map(e.keyword("id"),e.keyword("rpub.plugins.admin.themes.single-theme-page/form"),e.keyword("schema"),_),u=M.call(null,e.vector(e.vector(e.keyword("rpub.lib.forms/submitting"),o),e.vector(e.keyword("rpub.lib.forms/ready-to-submit"),o))),d=e.nth.call(null,u,0,null),c=e.nth.call(null,u,1,null),w=e.get.call(null,d,e.vector(e.keyword("rpub.lib.forms/submitting"),o)),h=e.get.call(null,d,e.vector(e.keyword("rpub.lib.forms/ready-to-submit"),o)),x=D.call(null,e.vector(e.vector(e.keyword("rpub.lib.forms/field-values"),e.vector(o,e.vector(e.keyword("label")))),e.vector(e.keyword("rpub.lib.forms/field-values"),e.vector(o,e.vector(e.keyword("html-template")))))),Q=A.call(null,function(){return c.call(null,e.keyword("rpub.lib.forms/init"),o)},[]),q=e.get_in.call(null,r,e.vector(e.keyword("value"),e.keyword("html-template")));return e.vector(e.keyword("div"),e.array_map(e.keyword("class"),"p-4"),e.vector(k.box,e.array_map(e.keyword("class"),"mb-4",e.keyword("title"),e.vector(e.keyword("div.flex"),e.vector(e.keyword("div.grow"),e.truth_.call(null,e.keyword("new").call(null,r))?"New Theme":e.vector(e.keyword("div"),e.vector(e.keyword("span.italic.text-blue-600"),"Theme: "),e.keyword("label").call(null,r))),e.vector(e.keyword("div"),e.truth_.call(null,e.keyword("new").call(null,r))?null:e.vector(y.delete_button,e.array_map(e.keyword("on-click"),function(m){return b.call(null,m,r)}),"Delete"))))),e.vector(k.box,e.array_map(e.keyword("content"),e.vector(e.keyword("form"),e.array_map(e.keyword("on-submit"),function(m){return v.call(null,m,o,r,x)}),e.vector(e.keyword("div"),e.array_map(e.keyword("class"),"grid gap-4 sm:grid-cols-2 sm:gap-6"),e.vector(e.keyword("div"),e.array_map(e.keyword("class"),"max-w-2xl"),e.vector(i.field,e.array_map(e.keyword("form"),o,e.keyword("field-config"),e.array_map(e.keyword("key"),e.keyword("label"),e.keyword("label"),"Name",e.keyword("type"),e.keyword("text"),e.keyword("value"),e.keyword("label").call(null,r)),e.keyword("input-component"),y.input2))),e.vector(i.field,e.array_map(e.keyword("form"),o,e.keyword("field-config"),e.array_map(e.keyword("key"),e.keyword("html-template"),e.keyword("label"),"HTML",e.keyword("value"),q),e.keyword("input-component"),p))),e.truth_.call(null,e.keyword("new").call(null,r))?e.vector(y.submit_button,e.array_map(e.keyword("ready-label"),"Create",e.keyword("submit-label"),"Creating...",e.keyword("disabled"),e.not.call(null,h),e.keyword("submitting"),w)):e.vector(y.submit_button,e.array_map(e.keyword("ready-label"),"Save",e.keyword("submit-label"),"Saving...",e.keyword("submitting"),w))))))},g=i.dag_config,K=e.array_map(e.keyword("page-id"),e.keyword("single-theme-page"),e.keyword("component"),f,e.keyword("dag-config"),g);export{K as config,g as dag_config,_ as form_schema,b as handle_delete,p as html_input,f as page,v as submit_form};
