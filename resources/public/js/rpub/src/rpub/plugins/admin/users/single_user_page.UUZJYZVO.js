import*as l from"cherry-cljs/cljs.core.js";import{useEffect as G}from"react";import{use_dag as U}from"rpub.lib.dag.react";import*as y from"rpub.lib.forms";import*as g from"rpub.lib.html";import*as D from"rpub.lib.http";import*as L from"rpub.plugins.admin.helpers";var b=l.array_map(l.keyword("username"),l.array_map(l.keyword("valid"),function(n){const r=l.string_QMARK_.call(null,n);if(l.truth_.call(null,r)){const e=l.seq.call(null,n);return l.truth_.call(null,e)?l.count.call(null,n)>=3:e}else return r},l.keyword("message"),"Must be at least 3 characters"),l.keyword("password"),l.array_map(l.keyword("valid"),function(n){const r=l.string_QMARK_.call(null,n);if(l.truth_.call(null,r)){const e=l.seq.call(null,n);return l.truth_.call(null,e)?l.count.call(null,n)>=6:e}else return r},l.keyword("message"),"Must be at least 6 characters"),l.keyword("roles"),l.array_map(l.keyword("valid"),function(n){const r=l.string_QMARK_.call(null,n);return l.truth_.call(null,r)?l.seq.call(null,n):r},l.keyword("message"),"Required")),m=function(n){const r=n,e=l.__destructure_map.call(null,r),t=l.get.call(null,e,l.keyword("value")),a=l.get.call(null,e,l.keyword("valid")),i=l.get.call(null,e,l.keyword("on-change")),u=l.get.call(null,e,l.keyword("type")),p=l.get.call(null,e,l.keyword("name"));return l.vector(g.input2,l.array_map(l.keyword("type"),u,l.keyword("name"),p,l.keyword("value"),t,l.keyword("class"),l.truth_.call(null,l.false_QMARK_.call(null,a))?"border-red-500":"",l.keyword("on-change"),i))},h=function(n){const r=l.array_map(l.keyword("id"),l.keyword("rpub.plugins.admin.users.single-user-page/form"),l.keyword("schema"),b),e=U.call(null,l.vector(l.vector(l.keyword("rpub.lib.forms/submitting"),r),l.vector(l.keyword("rpub.lib.forms/ready-to-submit"),r))),t=l.nth.call(null,e,0,null),a=l.nth.call(null,e,1,null),i=l.get.call(null,t,l.vector(l.keyword("rpub.lib.forms/submitting"),r)),u=l.get.call(null,t,l.vector(l.keyword("rpub.lib.forms/ready-to-submit"),r)),p=G.call(null,function(){return a.call(null,l.keyword("rpub.lib.forms/init"),r)},[]),x=function(k){if(k.preventDefault(),l.truth_.call(null,u))return a.call(null,l.keyword("rpub.plugins.admin.users.single-user-page/submit-start")),D.post.call(null,"/admin/api/create-user",l.array_map(l.keyword("body"),l.array_map())).then(function(c){return window.location.reload()}).catch(function(c){return a.call(null,l.keyword("rpub.plugins.admin.users.single-user-page/submit-error"))})},A=l.vector(l.array_map(l.keyword("key"),l.keyword("username"),l.keyword("label"),"Username",l.keyword("type"),l.keyword("text")),l.array_map(l.keyword("key"),l.keyword("password"),l.keyword("label"),"Password",l.keyword("type"),l.keyword("password")));return l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"p-4"),l.vector(L.box,l.array_map(l.keyword("title"),"New User",l.keyword("content"),l.vector(l.keyword("section"),l.array_map(l.keyword("class"),"bg-white"),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"max-w-2xl"),l.vector(l.keyword("form"),l.array_map(l.keyword("on-submit"),x),l.vector(l.keyword("div"),l.array_map(l.keyword("class"),"grid gap-4 sm:grid-cols-2 sm:gap-6"),function c(K){return new l.LazySeq(null,function(){let Q=K;for(;;){const w=l.seq.call(null,Q);if(l.truth_.call(null,w)){const o=w;if(l.truth_.call(null,l.chunked_seq_QMARK_.call(null,o))){const s=l.chunk_first.call(null,o),f=l.count.call(null,s),d=l.chunk_buffer.call(null,f);return(()=>{let _=0;for(;;){if(_<f){const z=l._nth.call(null,s,_);l.chunk_append.call(null,d,l.vector(y.field,l.array_map(l.keyword("form"),r,l.keyword("field-config"),z,l.keyword("input-component"),m))),_=l.unchecked_inc.call(null,_);continue}else return!0;break}})()?l.chunk_cons.call(null,l.chunk.call(null,d),c.call(null,l.chunk_rest.call(null,o))):l.chunk_cons.call(null,l.chunk.call(null,d),null)}else{const s=l.first.call(null,o);return l.cons.call(null,l.vector(y.field,l.array_map(l.keyword("form"),r,l.keyword("field-config"),s,l.keyword("input-component"),m)),c.call(null,l.rest.call(null,o)))}}break}},null,null)}.call(null,A),l.vector(g.submit_button,l.array_map(l.keyword("ready-label"),"Create",l.keyword("submit-label"),"Creating...",l.keyword("submitting"),i,l.keyword("disabled"),l.not.call(null,u))))))))))},v=function(n){return null},q=function(n){const r=n,e=l.__destructure_map.call(null,r),t=e,a=l.get.call(null,e,l.keyword("editing"));return l.truth_.call(null,a)?l.vector(v,t):l.vector(h,t)},M=y.dag_config,R=l.array_map(l.keyword("page-id"),l.keyword("single-user-page"),l.keyword("component"),q,l.keyword("dag-config"),M);export{R as config,M as dag_config,v as edit_user_page,b as form_schema,m as html_input,h as new_user_page,q as single_user_page};
