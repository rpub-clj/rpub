import*as e from"cherry-cljs/cljs.core.js";import*as j from"cherry-cljs/lib/clojure.string.js";import*as D from"rads.inflections";import{use_dag as z,use_dag_values as E}from"rpub.lib.dag.react";import*as x from"rpub.lib.html";import*as B from"rpub.lib.http";import*as L from"rpub.lib.permalinks";import*as S from"rpub.plugins.admin.helpers";var A=function(n){const o=n,l=e.__destructure_map.call(null,o),t=e.get.call(null,l,e.keyword("content-item")),r=e.get.call(null,l,e.keyword("editing")),c=e.get.call(null,l,e.keyword("creating")),u=e.get.call(null,l,e.keyword("field-types")),i=z.call(null),v=e.nth.call(null,i,0,null),m=e.nth.call(null,i,1,null),b=t,d=e.__destructure_map.call(null,b),f=e.get.call(null,d,e.keyword("content-type"));return e.vector(e.keyword("div"),function s(q){return new e.LazySeq(null,function(){let G=q;for(;;){const h=e.seq.call(null,G);if(e.truth_.call(null,h)){const y=h;if(e.truth_.call(null,e.chunked_seq_QMARK_.call(null,y))){const a=e.chunk_first.call(null,y),_=e.count.call(null,a),g=e.chunk_buffer.call(null,_);return(()=>{let w=0;for(;;){if(w<_){const p=e._nth.call(null,a,w),O=e.get_in.call(null,t,e.vector(e.keyword("document"),e.keyword("id").call(null,p)));e.chunk_append.call(null,g,e.vector(e.keyword("div.max-w-xl.mb-4"),e.array_map(e.keyword("key"),e.keyword("id").call(null,p)),e.vector(e.keyword("label.font-semibold.mb-1.block"),e.array_map(e.keyword("for"),e.keyword("name").call(null,p)),e.keyword("name").call(null,p)),e.vector(e.keyword("div"),x.custom_element.call(null,e.vector(e.get_in.call(null,u,e.vector(e.keyword("type").call(null,p),e.keyword("input"))),e.array_map(e.keyword("field"),p,e.keyword("value"),O,e.keyword("on-change"),function(R){const U=R.target.value;return m.call(null,e.keyword("rpub.plugins.content-types.admin.single-content-item-page/field-change"),e.assoc.call(null,p,e.keyword("value"),U))},e.keyword("editing"),r,e.keyword("creating"),c)))))),w=e.unchecked_inc.call(null,w);continue}else return!0;break}})()?e.chunk_cons.call(null,e.chunk.call(null,g),s.call(null,e.chunk_rest.call(null,y))):e.chunk_cons.call(null,e.chunk.call(null,g),null)}else{const a=e.first.call(null,y),_=e.get_in.call(null,t,e.vector(e.keyword("document"),e.keyword("id").call(null,a)));return e.cons.call(null,e.vector(e.keyword("div.max-w-xl.mb-4"),e.array_map(e.keyword("key"),e.keyword("id").call(null,a)),e.vector(e.keyword("label.font-semibold.mb-1.block"),e.array_map(e.keyword("for"),e.keyword("name").call(null,a)),e.keyword("name").call(null,a)),e.vector(e.keyword("div"),x.custom_element.call(null,e.vector(e.get_in.call(null,u,e.vector(e.keyword("type").call(null,a),e.keyword("input"))),e.array_map(e.keyword("field"),a,e.keyword("value"),_,e.keyword("on-change"),function(g){const w=g.target.value;return m.call(null,e.keyword("rpub.plugins.content-types.admin.single-content-item-page/field-change"),e.assoc.call(null,a,e.keyword("value"),w))},e.keyword("editing"),r,e.keyword("creating"),c))))),s.call(null,e.rest.call(null,y)))}}break}},null,null)}.call(null,e.sort_by.call(null,e.keyword("rank"),e.keyword("fields").call(null,f))))},C=function(n,o,l,t){n.preventDefault(),o.call(null,e.keyword("rpub.plugins.content-types.admin.single-content-item-page/start-submit"));const r=l.call(null),c=e.__destructure_map.call(null,r),u=e.get.call(null,c,e.keyword("rpub.plugins.content-types.admin.single-content-item-page/field-values")),i=e.update.call(null,t,e.keyword("document"),e.merge,u);return B.post.call(null,"/admin/api/content-types/update-content-item",e.array_map(e.keyword("body"),i))},N=function(n){const o=n,l=e.__destructure_map.call(null,o),t=e.get.call(null,l,e.keyword("content-type")),r=e.get.call(null,l,e.keyword("field-types")),c=z.call(null,e.vector(e.keyword("rpub.plugins.content-types.admin.single-content-item-page/submitting"))),u=e.nth.call(null,c,0,null),i=e.__destructure_map.call(null,u),v=e.get.call(null,i,e.keyword("rpub.plugins.content-types.admin.single-content-item-page/submitting")),m=e.nth.call(null,c,1,null),b=E.call(null,e.vector(e.keyword("rpub.plugins.content-types.admin.single-content-item-page/field-values"))),d=e.array_map(e.keyword("content-type"),t,e.keyword("document"),e.into.call(null,e.array_map(),e.map.call(null,function(k){return e.vector(e.keyword("id").call(null,k),null)},e.keyword("fields").call(null,t)))),f=function(k){return C.call(null,k,m,b,d).then(function(s){return e.prn.call(null,s),window.location=e.str.call(null,"/admin/content-types/",e.name.call(null,e.keyword("slug").call(null,t)),"/content-items/",e.keyword("id").call(null,s))})};return e.vector(e.keyword("div.p-4"),e.vector(S.box,e.array_map(e.keyword("class"),"mb-4",e.keyword("title"),e.str.call(null,"New ",D.singular.call(null,e.get_in.call(null,d,e.vector(e.keyword("content-type"),e.keyword("name"))))))),e.vector(e.keyword("form"),e.array_map(e.keyword("on-submit"),f),e.vector(S.box,e.array_map(e.keyword("content"),e.vector(e.keyword("div"),e.vector(A,e.array_map(e.keyword("content-item"),d,e.keyword("field-types"),r,e.keyword("creating"),!0)),e.vector(x.submit_button,e.array_map(e.keyword("ready-label"),"Create",e.keyword("submit-label"),"Creating...",e.keyword("submitting"),v)))))))},Q=function(n){const o=n,l=e.__destructure_map.call(null,o),t=e.get.call(null,l,e.keyword("content-type")),r=e.get.call(null,l,e.keyword("content-item")),c=e.get.call(null,l,e.keyword("field-types")),u=e.get.call(null,l,e.keyword("site-base-url")),i=e.get.call(null,l,e.keyword("permalink-routes")),v=z.call(null,e.vector(e.keyword("rpub.plugins.content-types.admin.single-content-item-page/submitting"))),m=e.nth.call(null,v,0,null),b=e.__destructure_map.call(null,m),d=e.get.call(null,b,e.keyword("rpub.plugins.content-types.admin.single-content-item-page/submitting")),f=e.nth.call(null,v,1,null),k=E.call(null,e.vector(e.keyword("rpub.plugins.content-types.admin.single-content-item-page/field-values"))),s=D.singular.call(null,e.keyword("name").call(null,t)),q=e.get_in.call(null,r,e.vector(e.keyword("fields"),"Title")),G=L.router.call(null,i),h=e.str.call(null,u,e.keyword("path").call(null,L.match_by_name.call(null,G,e.keyword("single"),e.array_map(e.keyword("content-type-slug"),e.name.call(null,e.keyword("slug").call(null,t)),e.keyword("content-item-slug"),e.get_in.call(null,r,e.vector(e.keyword("fields"),"Slug")))))),y=function(_){return confirm(e.str.call(null,"Are you sure you want to delete this ",j.lower_case.call(null,s),"?"))},a=function(_){return C.call(null,_,f,k,r).then(function(g){return window.location.reload()})};return e.vector(e.keyword("div.p-4"),e.vector(S.box,e.array_map(e.keyword("class"),"mb-4",e.keyword("title"),e.vector(e.keyword("div.flex"),e.vector(e.keyword("div.grow"),e.vector(e.keyword("span.italic.text-blue-600"),e.str.call(null,s,": ")),q),e.vector(e.keyword("div"),e.vector(x.delete_button,e.array_map(e.keyword("on-click"),y),"Delete"))),e.keyword("content"),e.vector(e.keyword("div"),e.vector(e.keyword("a.underline.text-gray-500"),e.array_map(e.keyword("href"),h,e.keyword("target"),"_blank"),h)))),e.vector(e.keyword("form"),e.array_map(e.keyword("on-submit"),a),e.vector(S.box,e.array_map(e.keyword("content"),e.vector(e.keyword("div"),e.vector(A,e.array_map(e.keyword("content-item"),r,e.keyword("field-types"),c,e.keyword("editing"),!0)),e.vector(x.submit_button,e.array_map(e.keyword("ready-label"),"Save",e.keyword("submit-label"),"Saving...",e.keyword("submitting"),d)))))))},T=function(n){const o=n,l=e.__destructure_map.call(null,o),t=l,r=e.get.call(null,l,e.keyword("editing"));return e.truth_.call(null,r)?e.vector(Q,t):e.vector(N,t)},I=function(n,o){return e.assoc_in.call(null,n,e.vector(e.keyword("rpub.plugins.content-types.admin.single-content-item-page/field-values"),e.keyword("id").call(null,o)),e.keyword("value").call(null,o))},K=function(n){return e.assoc.call(null,n,e.keyword("rpub.plugins.content-types.admin.single-content-item-page/submitting"),!0)},M=e.array_map(e.keyword("nodes"),e.array_map(e.keyword("rpub.plugins.content-types.admin.single-content-item-page/field-values"),e.array_map(e.keyword("calc"),e.keyword("rpub.plugins.content-types.admin.single-content-item-page/field-values")),e.keyword("rpub.plugins.content-types.admin.single-content-item-page/field-change"),e.array_map(e.keyword("push"),I),e.keyword("rpub.plugins.content-types.admin.single-content-item-page/start-submit"),e.array_map(e.keyword("push"),K),e.keyword("rpub.plugins.content-types.admin.single-content-item-page/submitting"),e.array_map(e.keyword("calc"),e.keyword("rpub.plugins.content-types.admin.single-content-item-page/submitting"))),e.keyword("edges"),e.vector(e.vector(e.keyword("rpub.plugins.content-types.admin.single-content-item-page/field-change"),e.keyword("rpub.plugins.content-types.admin.single-content-item-page/field-values")),e.vector(e.keyword("rpub.plugins.content-types.admin.single-content-item-page/start-submit"),e.keyword("rpub.plugins.content-types.admin.single-content-item-page/submitting")))),F=e.array_map(e.keyword("page-id"),e.keyword("single-content-item-page"),e.keyword("component"),T,e.keyword("dag-config"),M);export{F as config,A as content_item_fields,M as dag_config,Q as edit_content_item_page,I as field_change,N as new_content_item_page,T as single_content_item_page,K as start_submit,C as submit_form};
